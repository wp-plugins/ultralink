/*!
ultralink.js 0.9.2
Copyright 2012-2013 Ultralink Inc. All rights reserved.
*/
(function(){if(window.top!=window){return}var Ultralink={};var ulVersion="32";var ulVersionString="0.9.2";Ultralink.version=ulVersion;var CryptoJS=CryptoJS||function(i,m){var p={},h=p.lib={},n=h.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;b&&c.mixIn(b);c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a){a.hasOwnProperty(c)&&(this[c]=a[c])}a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.$super.extend(this)}}}(),o=h.WordArray=n.extend({init:function(a,b){a=this.words=a||[];this.sigBytes=b!=m?b:4*a.length},toString:function(a){return(a||e).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,a=a.sigBytes;this.clamp();if(d%4){for(var f=0;f<a;f++){b[d+f>>>2]|=(c[f>>>2]>>>24-8*(f%4)&255)<<24-8*((d+f)%4)}}else{if(65535<c.length){for(f=0;f<a;f+=4){b[d+f>>>2]=c[f>>>2]}}else{b.push.apply(b,c)}}this.sigBytes+=a;return this},clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-8*(b%4);a.length=i.ceil(b/4)},clone:function(){var a=n.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var b=[],c=0;c<a;c+=4){b.push(4294967296*i.random()|0)}return o.create(b,a)}}),q=p.enc={},e=q.Hex={stringify:function(a){for(var b=a.words,a=a.sigBytes,c=[],d=0;d<a;d++){var f=b[d>>>2]>>>24-8*(d%4)&255;c.push((f>>>4).toString(16));c.push((f&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2){c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8)}return o.create(c,b/2)}},g=q.Latin1={stringify:function(a){for(var b=a.words,a=a.sigBytes,c=[],d=0;d<a;d++){c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++){c[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4)}return o.create(c,b)}},j=q.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},k=h.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=o.create();this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var b=this._data,c=b.words,d=b.sigBytes,f=this.blockSize,e=d/(4*f),e=a?i.ceil(e):i.max((e|0)-this._minBufferSize,0),a=e*f,d=i.min(4*a,d);if(a){for(var g=0;g<a;g+=f){this._doProcessBlock(c,g)}g=c.splice(0,a);b.sigBytes-=d}return o.create(g,d)},clone:function(){var a=n.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});h.Hasher=k.extend({init:function(){this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);this._doFinalize();return this._hash},clone:function(){var a=k.clone.call(this);a._hash=this._hash.clone();return a},blockSize:16,_createHelper:function(a){return function(b,c){return a.create(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return l.HMAC.create(a,c).finalize(b)}}});var l=p.algo={};return p}(Math);(function(){var i=CryptoJS,m=i.lib,p=m.WordArray,m=m.Hasher,h=[],n=i.algo.SHA1=m.extend({_doReset:function(){this._hash=p.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(o,i){for(var e=this._hash.words,g=e[0],j=e[1],k=e[2],l=e[3],a=e[4],b=0;80>b;b++){if(16>b){h[b]=o[i+b]|0}else{var c=h[b-3]^h[b-8]^h[b-14]^h[b-16];h[b]=c<<1|c>>>31}c=(g<<5|g>>>27)+a+h[b];c=20>b?c+((j&k|~j&l)+1518500249):40>b?c+((j^k^l)+1859775393):60>b?c+((j&k|j&l|k&l)-1894007588):c+((j^k^l)-899497514);a=l;l=k;k=j<<30|j>>>2;j=g;g=c}e[0]=e[0]+g|0;e[1]=e[1]+j|0;e[2]=e[2]+k|0;e[3]=e[3]+l|0;e[4]=e[4]+a|0},_doFinalize:function(){var i=this._data,h=i.words,e=8*this._nDataBytes,g=8*i.sigBytes;h[g>>>5]|=128<<24-g%32;h[(g+64>>>9<<4)+15]=e;i.sigBytes=4*h.length;this._process()}});i.SHA1=m._createHelper(n);i.HmacSHA1=m._createHmacHelper(n)})();var realJSON;if(!realJSON){realJSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof realJSON.stringify!=="function"){realJSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("realJSON.stringify")}return str("",{"":value})}}if(typeof realJSON.parse!=="function"){realJSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("realJSON.parse")}}}());function isVersion(left,oper,right){if(left){var pre=/pre/i,replace=/[^\d]+/g,oper=oper||"==",right=right||jQuery().jquery,l=left.replace(replace,""),r=right.replace(replace,""),l_len=l.length,r_len=r.length,l_pre=pre.test(left),r_pre=pre.test(right);l=(r_len>l_len?parseInt(l)*((r_len-l_len)*10):parseInt(l));r=(l_len>r_len?parseInt(r)*((l_len-r_len)*10):parseInt(r));switch(oper){case"==":return(true==(l==r&&(l_pre==r_pre)));case">=":return(true==(l>=r&&(!l_pre||l_pre==r_pre)));case"<=":return(true==(l<=r&&(!r_pre||r_pre==l_pre)));case">":return(true==(l>r||(l==r&&r_pre)));case"<":return(true==(l<r||(l==r&&l_pre)))}}return false}var passedOptions=undefined;var alreadyStarted=false;var basePath="https://ultralink.me/";var pageProtocol=("https:"==document.location.protocol?"https://":"http://");var jQ=undefined;var oldJQuery=undefined;function loadCallback(scriptURL){if(typeof jQuery!="undefined"){jQuery.isVersion=isVersion;if(!jQuery.isVersion("1.7",">")){jQ=jQuery;if(oldJQuery!=undefined){jQuery.noConflict();window.jQuery=oldJQuery;oldJQuery=undefined}}}if((typeof jQ!="undefined")&&(typeof Raphael!="undefined")&&(passedOptions!=undefined)){reallyStartUltralink(passedOptions)}}function fallbackLoadScript(scriptURL,successCallback){if(scriptURL==basePath+"ultralinkLibraries/jquery+patch-min.js"){loadScript(pageProtocol+"ultralink.me/ultralinkLibraries/jquery+patch-min.js",successCallback)}else{if(scriptURL==basePath+"ultralinkLibraries/raphael+patch-min.js"){loadScript(pageProtocol+"ultralink.me/ultralinkLibraries/raphael+patch-min.js",successCallback)}}}function loadScript(scriptURL,successCallback){var head=document.getElementsByTagName("head")[0];var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src=scriptURL;s.onreadystatechange=function(){if(s.readyState=="loaded"||s.readyState=="complete"){if(successCallback){successCallback(scriptURL)}}else{if(s.readyState=="uninitialized"){fallbackLoadScript(scriptURL,successCallback)}}};s.onload=function(){if(successCallback){successCallback(scriptURL)}};s.onerror=function(){fallbackLoadScript(scriptURL,successCallback)};head.appendChild(s)}if(!Ultralink.sendExtensionMessage){Ultralink.sendExtensionMessage=function(type,query){var theCommand=document.createElement("command");theCommand.setAttribute("type",type);theCommand.textContent=realJSON.stringify(query);var loadedEl=document.getElementsByTagName("ultralinkloaded");if(loadedEl.length>0){loadedEl[0].appendChild(theCommand)}}}function testCSS(prop){return prop in document.documentElement.style}var isOpera=!!(window.opera&&window.opera.version);var isFirefox=testCSS("MozBoxSizing");var isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;var isChrome=!isSafari&&!isOpera&&testCSS("WebkitTransform");var isIE=
/*@cc_on!@*/
false||testCSS("msTransform");var isWebkit=/webkit/.test(navigator.userAgent.toLowerCase());var ULLinkTypes={href:"Link",href2:"Link 2",href3:"Link 3",buy:"Buy",video:"Video",videoyoutube:"YouTube",wikipedia:"Wikipedia",mediawiki:"MediaWiki",freebase:"Freebase",angellist:"AngelList",annotation:"Annotation",map:"Map",mapgoogle:"Google Map",buylinkshareapple:"Buy",buyamazon:"Buy",buyebay:"Buy",imdb:"IMDB",manpage:"Documentation",appios:"iOS App",appmac:"Mac App",appwebos:"webOS App",appandroid:"Android App",appwindows:"Windows App",facebook:"Facebook",twitter:"Twitter",linkedin:"LinkedIn",googleplus:"Google+",github:"GitHub",searchgoogle:"Google Search",searchyahoo:"Yahoo Search",searchbing:"Bing Search",search:"Search"};var linkDetectors=Array();linkDetectors["(.png|.jpeg|.jpg|.gif|.tiff|.svg)$"]="image";linkDetectors["http.*gravatar.com/avatar/"]="image";linkDetectors["http.*wikipedia.org/wiki/(?!(User|Wikipedia|File|MediaWiki|Template|Help|Category|Portal|Book|Education_Program|TimedText)(_talk)?:)"]="wikipedia";linkDetectors["http.*freebase.com"]="freebase";linkDetectors["http.*angel.co"]="angellist";linkDetectors["http.*ultralink.me/annotation/"]="annotation";linkDetectors["http.*www.amazon.com"]="buyamazon";linkDetectors["http.*ebay.com"]="buyebay";linkDetectors["http://click.linksynergy.com.*partnerId%253D30"]="buylinkshareapple";linkDetectors["http://click.linksynergy.com"]="buy";linkDetectors["http.*www.imdb.com"]="imdb";linkDetectors["http.*developer.apple.com.*/Manpages/"]="manpage";linkDetectors["http.*opengl.org.*/docs/man/"]="manpage";linkDetectors["http.*developer.palm.com/appredirect"]="appwebos";linkDetectors["http.*linkedin.com"]="linkedin";linkDetectors["http.*facebook.com"]="facebook";linkDetectors["http.*twitter.com"]="twitter";linkDetectors["http.*plus.google.com"]="googleplus";linkDetectors["http.*maps.google.com"]="mapgoogle";linkDetectors["http.*youtube.com"]="videoyoutube";linkDetectors["http.*google.com/search?"]="searchgoogle";linkDetectors["http.*search.yahoo.com/search?"]="searchyahoo";linkDetectors["http.*bing.com/search?"]="searchbing";var hardcodedSites=[];hardcodedSites.push({siteRegex:"http.*wikipedia\\.org",selector:"div.mw-content-ltr p, div.mw-content-ltr ul, div.mw-content-ltr dl"});hardcodedSites.push({siteRegex:"http.*economist\\.com",selector:"div.main-content p"});hardcodedSites.push({siteRegex:"http.*blogspot\\.com",selector:"div.entry-content"});hardcodedSites.push({siteRegex:"http.*news\\.google\\.com/?$",selector:"div.esc-lead-snippet-wrapper"});hardcodedSites.push({siteRegex:"http.*daringfireball\\.net",selector:"div.article p, div.article ul, div.article dl, dl dd"});hardcodedSites.push({siteRegex:"http.*tmz\\.com",selector:"div.all-post-body"});hardcodedSites.push({siteRegex:"http.*guardian\\.co\\.uk",selector:"div#article-body-blocks"});var browserLanguage="en";var browserCountry="US";var L=window.navigator.language;if(!L){L=window.navigator.browserLanguage}var languageResult=L.match(RegExp("([a-z,A-Z]{2})(-[a-z,A-Z]{2})?"));if((languageResult!=null)&&(languageResult.length>=2)){browserLanguage=languageResult[1].toLowerCase()}var countryResult=L.match(RegExp("[a-z,A-Z]{2}-([a-z,A-Z]{2})"));if((countryResult!=null)&&(countryResult.length>=2)){browserCountry=countryResult[1].toUpperCase()}var options={failsafe:"true",environment:"javascript",editorStyle:"false",associatedWebsite:window.location.protocol+"//"+window.location.host,imagesURL:pageProtocol+"ultralink.me/ultralinkImages/",scanFirst:"true",UMAnalytics:"true",notLivePage:"false",noHover:"false",previewCallback:undefined,database:"",replaceHyperlinks:"false",cleanMode:"false",addSearch:"true",seperateSearch:"false",searchURL:"http://www.google.com/search?q=",newWindows:"false",proximityFade:"true",hoverTime:100000,scanSelector:".ultralink",userLanguageOrder:[browserLanguage],userCountryOrder:[browserCountry],hoverRecoverTime:100,inlinePopups:"true",iconSide:"right",combineLikeButtons:"true"};var analyticsInterface=pageProtocol+"ultralink.me/API/current/analytics/";var APIInterface="https://ultralink.me/API/current/";var touchInterface="ontouchstart" in window;var sections=[];var currentSelector="";var sectionHashes=[];var mouseDown=0;var altDown=0;var currentUword=undefined;var pendingPopup;var ulInlineOut=false;var ulInlineOutOnce=false;var ulThumbnailIndex=0;var ulThumbnails=[];var ulThumbnailInterval=undefined;var slideshowOn=true;var currentTimeout;var currentHoveringLink;var inlineContentCache={};var supportedInlineTypes=["wikipedia","mediawiki","angellist","annotation","twitter","videoyoutube","mapgoogle","ultralinkme"];var hoverRecover=false;var inlineIconSize=40;var inlineIconSpacing=10;var inlinePreviewX=75;var inlinePreviewY=75;var inlineArrowX=15;var inlineArrowY=30;var inlineOffsetX=3;var inlineBackColor="black";var inlineStrokeWidth=3;var inlineUMStrokeWidth=0.5;var inlineStrokeColor="#ddd";var inlineStrokeOpacity=1;var inlinePreviewSpinnerInset=20;var inlineFullInset=15;var inlinePopupCorners=10;var iconPreviewStrokeColor="black";var iconNoPreviewStrokeColor="#0000ff";var iconPreviewOutlineOpacity=0.6;var iconNoPreviewOutlineOpacity=0.45;var iconOutlineGlowWidth;var lowerBoundSize=22;var generalOpacity=0.6;var rectTopColor="#ccc";var rectBottomColor="#eee";var rectStrokeWidth;var rectStrokeColor="#000";var rectPaddingX;var rectPaddingY;var rectRoundedCorner;var rectHoleOutsetX;var rectHoleOutsetY;var rectPopupOffsetX;var rectPopupOffsetY;var rectGlowColor="#000";var rectGlowOpacity=0.12;var rectGlowWidth;var rectGlowOffsetY;var inlineGlowColor="#000";var inlineGlowOpacity=0.06;var inlineGlowWidth=4;var inlineGlowOffsetY=0.5;var nextStrokeWidth;var nextStrokeColor="#bbb";var nextArrowStrokeColor="#fff";var nextGlowOpacity=0.06;var nextGlowWidth;var imageRoundedCorner=10;var fSize;var buttonTopColor="#aaa";var buttonTopHighlightColor="#999";var buttonUpperColor="#aaa";var buttonUpperHighlightColor="#88a";var buttonUpperPercentage="25";var buttonLowerColor="#aaa";var buttonLowerHighlightColor="#88a";var buttonLowerPercentage="75";var buttonBottomColor="#bbb";var buttonBottomHighlightColor="#aaa";var buttonStrokeColor="#000";var buttonStrokeColorHighlight="#005";var buttonStrokeWidth;var buttonStrokeWidthHighlight;var buttonRoundedCorner;var buttonLabelWidth;var buttonWidth;var buttonHeight;var buttonSpacing;var buttonIconSpacing;var buttonLabelColor="#fafafa";var buttonLabelHighlightColor="#fff";var labelTextShadowOpacity=0.4;var labelTextShadowBlurOpacity=0.4;var labelTextShadowRadius="12px";var labelTextShadowStdDev=4;var fontShrinkage=0.8;function resetConstants(){iconOutlineGlowWidth=3;rectStrokeWidth=0.25;rectPaddingX=3;rectPaddingY=3;rectRoundedCorner=12;rectHoleOutsetX=4.5;rectHoleOutsetY=4.5;rectPopupOffsetX=5.5;rectPopupOffsetY=5.5;rectGlowWidth=4;rectGlowOffsetY=1;nextStrokeOutlineWidth=0.8;nextStrokeArrowWidth=2.5;nextGlowWidth=8;buttonStrokeWidth=0.4;buttonStrokeWidthHighlight=0.75;buttonRoundedCorner=7;buttonLabelWidth=45;buttonWidth=45;buttonHeight=25;buttonSpacing=5;buttonIconSpacing=8}function sizeConstants(rS){iconOutlineGlowWidth*=rS;rectStrokeWidth*=rS;rectPaddingX*=rS;rectPaddingY*=rS;rectRoundedCorner*=rS;rectHoleOutsetX*=rS;rectHoleOutsetY*=rS;rectPopupOffsetX*=rS;rectPopupOffsetY*=rS;rectGlowWidth*=rS;rectGlowOffsetY*=rS;nextStrokeOutlineWidth*=rS;nextStrokeArrowWidth*=rS;nextGlowWidth*=rS;buttonStrokeWidth*=rS;buttonStrokeWidthHighlight*=rS;buttonRoundedCorner*=rS;buttonLabelWidth*=rS;buttonHeight*=rS;buttonSpacing*=rS;buttonIconSpacing*=rS}resetConstants();function sleep(milliSeconds){var startTime=new Date().getTime();while(new Date().getTime()<startTime+milliSeconds){}}function getDomain(url){var result=url.match(RegExp("://(www[0-9]?.)?(.[^/:]+)"));if((result!=null)&&(result.length>=2)){return result[2]}return url}function getFullDomain(url){var result=url.match(RegExp("://(.[^/:]+)"));if((result!=null)&&(result.length>=2)){return result[1]}return url}function getFullDomainWithTransport(url){var result=url.match(RegExp("(.*)://(.[^/:]+)"));if((result!=null)&&(result.length>=2)){return result[1]+"://"+result[2]}return url}var getIERE=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");function getInternetExplorerVersion(){var rv=-1;if(window.navigator.appName=="Microsoft Internet Explorer"){if(getIERE.exec(window.navigator.userAgent)!=null){rv=parseFloat(RegExp.$1)}}return rv}function overrideSettings(userOptions){if(alreadyStarted==true){Ultralink.setOptions(userOptions)}else{setTimeout(function(){overrideSettings(userOptions)},2000)}}function getStyle(el,cssprop){var s;var now=new Date().getTime();var theStyle="style-"+cssprop;if((el[theStyle]==undefined)||((now-el[theStyle+"_ts"])>5000)){var dv=document.defaultView;if(dv&&dv.getComputedStyle){s=dv.getComputedStyle(el,"")[cssprop]}else{if(el.currentStyle){s=el.currentStyle[cssprop]}else{s=el.style[cssprop]}}if((cssprop=="fontSize")||(cssprop=="color")){el[theStyle]=s;el[theStyle+"_ts"]=now}}else{s=el[theStyle]}return s}function bodyCheck(){var theBody=jQ("body")[0];if(theBody!=undefined){var csp=getStyle(theBody,"position");if(csp!=null){if(csp=="relative"){theBody.style.setProperty("position","static")}}}}function linkImageSize(fSize){var imgSize=128;if(!touchInterface){var adjustedFSize=fSize;if(isWebkit){adjustedFSize*=(document.width/jQ(document).width())*window.devicePixelRatio}else{if(isIE){adjustedFSize*=screen.deviceXDPI/screen.logicalXDPI}}if(adjustedFSize<=16){imgSize=16}else{if(adjustedFSize<=32){imgSize=32}else{if(adjustedFSize<=64){imgSize=64}}}}else{imgSize=64}return imgSize}function setDataUl(el,key,value){el[key]=value;var a=el.attributes[key];if(a){el.attributes[key].value=realJSON.stringify(value)}}function getDataUl(el,key){if(el[key]){return el[key]}else{var a=el.attributes[key];if(a){var value=realJSON.parse(a.value);setDataUl(el,key,value);el.removeAttribute(key);return value}}return undefined}function cumulativeOffset(element){if(element.getBoundingClientRect){var box=element.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var top=box.top+scrollTop-clientTop;var left=box.left+scrollLeft-clientLeft;return[Math.round(left),Math.round(top)]}var top=0;var left=0;while(element){top=top+parseInt(element.offsetTop,10);left=left+parseInt(element.offsetLeft,10);element=element.offsetParent}return[left,top]}function getElementOffset(el){var os;if(el.umoffset==undefined){var uw=jQ(el);el.umoffset=uw.offset();el.umoffset.width=uw.width();el.umoffset.height=uw.height()}os=el.umoffset;return os}function elementInView(elem){var jqw=jQ(window);var os=getElementOffset(elem);var docViewTop=jqw.scrollTop();if(os.top+os.height<docViewTop){return false}if(os.top>docViewTop+jqw.height()){return false}return true}function parse_url(str,component){var key=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"];var ini=(this.php_js&&this.php_js.ini)||{};var mode=(ini["phpjs.parse_url.mode"]&&ini["phpjs.parse_url.mode"].local_value)||"php";parser={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};var m=parser[mode].exec(str);var uri={};var i=14;while(i--){if(m[i]){uri[key[i]]=m[i]}}if(component){return uri[component.replace("PHP_URL_","").toLowerCase()]}if(mode!=="php"){var name=(ini["phpjs.parse_url.queryKey"]&&ini["phpjs.parse_url.queryKey"].local_value)||"queryKey";parser=/(?:^|&)([^&=]*)=?([^&]*)/g;uri[name]={};uri[key[12]].replace(parser,function($0,$1,$2){if($1){uri[name][$1]=$2}})}delete uri.source;return uri}function parse_str(str,array){var strArr=String(str).replace(/^&/,"").replace(/&$/,"").split("&"),sal=strArr.length,i,j,ct,p,lastObj,obj,lastIter,undef,chr,tmp,key,value,postLeftBracketPos,keys,keysLen,fixStr=function(str){return decodeURIComponent(str.replace(/\+/g,"%20"))};if(!array){array=this.window}for(i=0;i<sal;i++){tmp=strArr[i].split("=");key=fixStr(tmp[0]);value=(tmp.length<2)?"":fixStr(tmp[1]);while(key.charAt(0)===" "){key=key.slice(1)}if(key.indexOf("\x00")>-1){key=key.slice(0,key.indexOf("\x00"))}if(key&&key.charAt(0)!=="["){keys=[];postLeftBracketPos=0;for(j=0;j<key.length;j++){if(key.charAt(j)==="["&&!postLeftBracketPos){postLeftBracketPos=j+1}else{if(key.charAt(j)==="]"){if(postLeftBracketPos){if(!keys.length){keys.push(key.slice(0,postLeftBracketPos-1))}keys.push(key.substr(postLeftBracketPos,j-postLeftBracketPos));postLeftBracketPos=0;if(key.charAt(j+1)!=="["){break}}}}}if(!keys.length){keys=[key]}for(j=0;j<keys[0].length;j++){chr=keys[0].charAt(j);if(chr===" "||chr==="."||chr==="["){keys[0]=keys[0].substr(0,j)+"_"+keys[0].substr(j+1)}if(chr==="["){break}}obj=array;for(j=0,keysLen=keys.length;j<keysLen;j++){key=keys[j].replace(/^['"]/,"").replace(/['"]$/,"");lastIter=j!==keys.length-1;lastObj=obj;if((key!==""&&key!==" ")||j===0){if(obj[key]===undef){obj[key]={}}obj=obj[key]}else{ct=-1;for(p in obj){if(obj.hasOwnProperty(p)){if(+p>ct&&p.match(/^\d+$/g)){ct=+p}}}key=ct+1}}lastObj[key]=value}}}function rewriteAffiliateLink(baseURL,type){var aInfo=options[type+"_affiliateInfo"];if(aInfo&&(aInfo!="")){var output={};parse_str(parse_url(baseURL,"PHP_URL_QUERY"),output);switch(type){case"buyamazon":if(output.tag){return baseURL.replace(output.tag,aInfo)}else{return baseURL+"&tag="+aInfo}break;case"buylinkshareapple":if(output.id){return baseURL.replace(output.id,aInfo)}else{return baseURL+"&id="+aInfo}break;case"buyebay":if(output.campid){return baseURL.replace(output.campid,aInfo)}else{return baseURL+"&campid="+aInfo}break;default:return baseURL;break}}return baseURL}function rrectPath(x,y,w,h,c){return"M "+(x+w)+","+(y+c)+"L "+(x+w)+","+(y+h-c)+"Q "+(x+w)+","+(y+h)+","+(x+w-c)+","+(y+h)+"L "+(x+c)+","+(y+h)+"Q "+x+","+(y+h)+","+x+","+(y+h-c)+"L "+x+","+(y+c)+"Q "+x+","+y+","+(x+c)+","+y+"L "+(x+w-c)+","+y+"Q "+(x+w)+","+y+","+(x+w)+","+(y+c)+"z"}function rrectPath2(x,y,w,h,c){return"M "+(x+w)+","+(y+c)+"Q "+(x+w)+","+y+","+(x+w-c)+","+y+"L "+(x+c)+","+y+"Q "+x+","+y+","+x+","+(y+c)+"L "+x+","+(y+h-c)+"Q "+x+","+(y+h)+","+(x+c)+","+(y+h)+"L "+(x+w-c)+","+(y+h)+"Q "+(x+w)+","+(y+h)+","+(x+w)+","+(y+h-c)+"L "+(x+w)+","+(y+c)+"z"}function rrectPathArrowRight(x,y,w,h,c,aX,aY,aoY){return"M"+(x+w)+","+(y+c)+" L"+(x+w)+","+(y+h/2-aY/2+aoY)+" L"+(x+w+aX)+","+(y+h/2+aoY)+" L"+(x+w)+","+(y+h/2+aY/2+aoY)+" L"+(x+w)+","+(y+h-c)+" Q"+(x+w)+","+(y+h)+","+(x+w-c)+","+(y+h)+" L"+(x+c)+","+(y+h)+" Q"+x+","+(y+h)+","+x+","+(y+h-c)+" L"+x+","+(y+c)+" Q"+x+","+y+","+(x+c)+","+y+" L"+(x+w-c)+","+y+" Q"+(x+w)+","+y+","+(x+w)+","+(y+c)+" z"}function rrectPathArrowLeft(x,y,w,h,c,aX,aY,aoY){return"M"+(x+w)+","+(y+c)+" L"+(x+w)+","+(y+h-c)+" Q"+(x+w)+","+(y+h)+","+(x+w-c)+","+(y+h)+" L"+(x+c)+","+(y+h)+" Q"+x+","+(y+h)+","+x+","+(y+h-c)+" L"+x+","+(y+h/2+aY/2+aoY)+" L"+(x-aX)+","+(y+h/2+aoY)+" L"+x+","+(y+h/2-aY/2+aoY)+" L"+x+","+(y+c)+" Q"+x+","+y+","+(x+c)+","+y+" L"+(x+w-c)+","+y+" Q"+(x+w)+","+y+","+(x+w)+","+(y+c)+"z"}function rrectPathArrowUp(x,y,w,h,c,aX,aY,aoX){return"M"+(x+w)+","+(y+c)+" L"+(x+w)+","+(y+h-c)+" Q"+(x+w)+","+(y+h)+","+(x+w-c)+","+(y+h)+" L"+(x+c)+","+(y+h)+" Q"+x+","+(y+h)+","+x+","+(y+h-c)+" L"+x+","+(y+c)+" Q"+x+","+y+","+(x+c)+","+y+" L"+(x+w/2-aX/2+aoX)+","+y+" L"+(x+w/2+aoX)+","+(y-aY)+" L"+(x+w/2+aX/2+aoX)+","+y+" L L"+(x+w-c)+","+y+" Q"+(x+w)+","+y+","+(x+w)+","+(y+c)+" z"}function setAsLinkAnchor(theEl,URL,type,category,word,database,ID){theEl.href=URL;if(options.newWindows=="true"){theEl.target="_blank"}theEl.UMType=type;theEl.UMUrl=URL;theEl.UMCategory=category;theEl.UMWord=word;theEl.UMID=ID;if(database!=undefined){theEl.UMDatabase=database}}function removeOldPopup(){if(currentUword!=undefined){var uword=currentUword;if(uword.paper!=undefined){var P=uword.paper;checkNewUltralink();P.myRrect.stop();var i;for(i=0;i<P.ULButtons.length;i++){P.ULButtons[i].stop();jQ.cleanData([P.ULButtons[i].node.parentNode])}for(i=0;i<P.ULLabels.length;i++){jQ.cleanData([P.ULLabels[i]]);document.body.removeChild(P.ULLabels[i])}for(i=0;i<P.ULImages.length;i++){jQ.cleanData([P.ULImages[i]]);document.body.removeChild(P.ULImages[i])}for(i=0;i<P.ULImageBacks.length;i++){jQ.cleanData([P.ULImageBacks[i]]);document.body.removeChild(P.ULImageBacks[i])}if(P.umLink){jQ.cleanData([P.umLink.outline]);document.body.removeChild(P.umLink.outline);jQ.cleanData([P.umLink]);document.body.removeChild(P.umLink)}if(P.ULthumbnail){P.ULthumbnail.stop();jQ.cleanData([P.ULthumbnail.node.parentNode])}removeOldInlinePopup();P.remove();delete uword.paper;delete uword.autoPopup;currentUword=undefined;currentHoveringLink=undefined;ulInlineOut=false;ulInlineOutOnce=false;ulThumbnailIndex=0;ulThumbnails=[];if(ulThumbnailInterval!=undefined){clearInterval(ulThumbnailInterval);ulThumbnailInterval=undefined}slideshowOn=true}if((uword.baseMatches!=undefined)&&(uword.baseParents!=undefined)){for(var matchIndex=0;matchIndex<uword.baseMatches.length;matchIndex++){uword.baseMatches[matchIndex].setAttribute("href",uword.baseHrefs[matchIndex]);uword.baseParents[matchIndex].appendChild(uword.baseMatches[matchIndex])}delete uword.baseMatches;delete uword.baseParents;delete uword.baseHrefs}}}function removeOldInlinePopup(){if(currentUword!=undefined){var uword=currentUword;if(uword.inlinePaper!=undefined){var iP=uword.inlinePaper;if(iP.linkType=="ultralinkme"){checkNewUltralink()}if(iP.inlineDiv!=undefined){jQ("iframe",iP.inlineDiv).each(function(){this.setAttribute("src","about:blank")});jQ("iframe",iP.inlineDiv).remove();jQ(iP.inlineDiv).remove()}iP.remove();delete uword.inlinePaper;if(uword.expanded==true){delete uword.expanded}ulInlineOut=false}if(uword.paper!=undefined){if(uword.paper.imageIndicatorCircle){uword.paper.imageIndicatorCircle.remove();delete uword.paper.imageIndicatorCircle}}}}function restorePreviousInlineButton(uword){var iP=uword.inlinePaper;if((iP!=undefined)&&(iP.ULAnchor!=undefined)){if(iP.ULAnchor.outline.previewAvailable==true){iP.ULAnchor.setAttribute("href","");iP.ULAnchor.removeAttribute("href");iP.ULAnchor.UMActionType="blackShadow";iP.ULAnchor.outline.className="ultralinkLinkImageBackPreview"}}}function setInlineULImage(theULAnchor){if(theULAnchor!=undefined){if(currentUword!=undefined){var uword=currentUword;var iP=uword.inlinePaper;if((iP!=undefined)&&(iP.ULAnchor==theULAnchor)){}else{restorePreviousInlineButton(uword);createInlinePopup(theULAnchor.linkType,theULAnchor.URL,theULAnchor)}}}}function removeTextShadowCallout(thisUword){thisUword.style.textShadow="none";if((isIE)&&(getInternetExplorerVersion()<10)){var ss=thisUword.ieSpan;ss.style.setProperty("filter","");ss.style.setProperty("display","none")}}function addTextShadowCallout(thisUword,alpha){var ul=getDataUl(thisUword,"data-ul");var status="hit";if(ul&&ul.status){status=ul.status}var nr=0;if(ul&&ul.needsReview){nr=ul.needsReview}if((status=="hit")||(options.editorStyle=="true")){var hoverBlurSize=7;if(isFirefox||isOpera){hoverBlurSize=5}var hoverBlurOffset=1;var fontSize=getStyle(thisUword,"fontSize");var fSize=parseFloat(fontSize);if(fSize<lowerBoundSize){fSize=lowerBoundSize;fontSize=lowerBoundSize+"px"}var relativeSize=fSize/16;var thisBlurColor="51, 51, 255";if(status!="hit"){thisBlurColor="255, 51, 51"}else{if((nr!=0)&&(options.editorStyle=="true")){thisBlurColor="0, 255, 0"}else{var theTextColor=getStyle(thisUword,"color");var tc=Raphael.color(theTextColor);if((tc.r*299+tc.g*587+tc.b*114)/1000>=150){thisBlurColor="255, 255, 255"}}}thisUword.style.textShadow="0px "+hoverBlurOffset*relativeSize+"px "+hoverBlurSize*relativeSize+"px rgba("+thisBlurColor+", "+alpha+")";if((isIE)&&(getInternetExplorerVersion()<10)){var ss=thisUword.ieSpan;if(alpha>0.99){alpha=1}ss.style.setProperty("filter","progid:DXImageTransform.Microsoft.Blur(makeshadow='true', ShadowOpacity="+alpha+", pixelradius="+(10*alpha)+")");ss.style.setProperty("display","inline-block");ss.style.setProperty("margin-top",(-10*alpha)+"px");ss.style.setProperty("margin-left",(-10*alpha)+"px");thisUword.style.setProperty("display","inline-block")}}}function setShadowCallout(uword,event){if(uword!=pendingPopup){var distanceSquared=12000;var distanceCutoffFactor=2;if(isOpera||isFirefox){distanceCutoffFactor=1.25}var os=getElementOffset(uword);var dX=0;var dY=event.pageY-(os.top+os.height/2);if(event.pageX<os.left){dX=os.left-event.pageX}else{if(event.pageX>=(os.left+os.width)){dX=event.pageX-(os.left+os.width)}}var d2=dX*dX+dY*dY;if(d2<distanceSquared){addTextShadowCallout(uword,(distanceSquared-d2)/(distanceSquared*distanceCutoffFactor))}else{removeTextShadowCallout(uword)}}}function setRippleTransition(uword,alpha){var rippleFadeRate=0.75;var prefix="";if(isWebkit){prefix="-webkit-"}uword.style.setProperty(prefix+"transition","");addTextShadowCallout(uword,alpha);var thisUword=uword;setTimeout(function(){thisUword.style.setProperty(prefix+"transition","text-shadow "+rippleFadeRate+"s ease-in");addTextShadowCallout(thisUword,0);if(!touchInterface){setTimeout(function(){uword.style.setProperty(prefix+"transition","")},rippleFadeRate+1000)}},1000)}function setShadowRipple(uword,event){if(uword!=pendingPopup){var distanceRippleSquared=120000;var distanceRippleCutoffFactor=1;var os=getElementOffset(uword);var dX=event.pageX-(os.left+os.width/2);var dY=event.pageY-(os.top+os.height/2);var d2=dX*dX+dY*dY;if(d2<distanceRippleSquared){var alpha=(distanceRippleSquared-d2)/(distanceRippleSquared*distanceRippleCutoffFactor);setRippleTransition(uword,alpha)}else{removeTextShadowCallout(uword)}}}function clearAllHighlights(){jQ("uword").each(function(){var ul=getDataUl(this,"data-ul");if(!(ul&&(ul.callout)&&(ul.callout=="normal"))){removeTextShadowCallout(this)}})}function highlightVisibleUltralinks(){for(var s=0;s<sections.length;s++){if(elementInView(sections[s])){jQ("uword",sections[s]).each(function(){var ul=getDataUl(this,"data-ul");if(!(ul&&(ul.callout)&&(ul.callout=="normal"))){addTextShadowCallout(this,1)}})}}}function repositionPopup(uword){if((typeof uword!="undefined")&&(uword.paper!=undefined)){var nuPosition=cumulativeOffset(uword);var deltaLeft=nuPosition[0]-uword.trueOffsetLeft;var deltaTop=nuPosition[1]-uword.trueOffsetTop;if(((nuPosition[0]==0)||(nuPosition[1]==0))&&((deltaLeft!=0)||(deltaTop!=0))){removeOldPopup();hoverRecover=false}else{if(deltaLeft||deltaTop){var P=uword.paper;var iP=uword.inlinePaper;P.canvas.style.setProperty("left",(parseFloat(P.canvas.style.left)+(deltaLeft))+"px");P.canvas.style.setProperty("top",(parseFloat(P.canvas.style.top)+(deltaTop))+"px");if(iP!=undefined){iP.canvas.style.setProperty("left",(parseFloat(iP.canvas.style.left)+(deltaLeft))+"px");iP.canvas.style.setProperty("top",(parseFloat(iP.canvas.style.top)+(deltaTop))+"px");if(iP.inlineDiv!=undefined){iP.inlineDiv.style.setProperty("left",(parseFloat(iP.inlineDiv.style.left)+(deltaLeft))+"px");iP.inlineDiv.style.setProperty("top",(parseFloat(iP.inlineDiv.style.top)+(deltaTop))+"px")}}for(i=0;i<P.ULLabels.length;i++){P.ULLabels[i].style.setProperty("left",(parseFloat(P.ULLabels[i].style.left)+(deltaLeft))+"px");P.ULLabels[i].style.setProperty("top",(parseFloat(P.ULLabels[i].style.top)+(deltaTop))+"px")}for(i=0;i<P.ULImages.length;i++){P.ULImages[i].style.setProperty("left",(parseFloat(P.ULImages[i].style.left)+(deltaLeft))+"px");P.ULImages[i].style.setProperty("top",(parseFloat(P.ULImages[i].style.top)+(deltaTop))+"px")}for(i=0;i<P.ULImages.length;i++){P.ULImageBacks[i].style.setProperty("left",(parseFloat(P.ULImageBacks[i].style.left)+(deltaLeft))+"px");P.ULImageBacks[i].style.setProperty("top",(parseFloat(P.ULImageBacks[i].style.top)+(deltaTop))+"px")}if(P.umLink){P.umLink.style.setProperty("left",(parseFloat(P.umLink.style.left)+(deltaLeft))+"px");P.umLink.style.setProperty("top",(parseFloat(P.umLink.style.top)+(deltaTop))+"px");P.umLink.outline.style.setProperty("left",(parseFloat(P.umLink.outline.style.left)+(deltaLeft))+"px");P.umLink.outline.style.setProperty("top",(parseFloat(P.umLink.outline.style.top)+(deltaTop))+"px")}uword.trueOffsetLeft+=deltaLeft;uword.trueOffsetTop+=deltaTop;uword.popupX=uword.trueOffsetLeft-rectPopupOffsetX-rectHoleOutsetX-rectPaddingX;uword.popupY=uword.trueOffsetTop-rectPopupOffsetY-rectHoleOutsetY-rectPaddingY-uword.thumbnailH}}}}function checkReposition(uword,time){if((currentUword!=undefined)&&(currentUword==uword)){setTimeout(function(){repositionPopup(uword);checkReposition(uword,time+250)},time)}}function createPopup(uword,cm){if(typeof cm=="undefined"){cm=0}if(options.previewCallback!=undefined){options.previewCallback(uword,cm)}if((pendingPopup==uword)&&(typeof uword!="undefined")){clearAllHighlights();pendingPopup=undefined;removeOldPopup();ulThumbnailIndex=0;ulThumbnails=[];if(ulThumbnailInterval!=undefined){clearInterval(ulThumbnailInterval);ulThumbnailInterval=undefined}slideshowOn=true;currentUword=uword;if(options.hoverRecoverTime>0){hoverRecover=true}uword.baseMatches=document.querySelectorAll("base[href]");uword.baseParents=[];uword.baseHrefs=[];for(var matchIndex=0;matchIndex<uword.baseMatches.length;matchIndex++){uword.baseHrefs[matchIndex]=uword.baseMatches[matchIndex].getAttribute("href");uword.baseMatches[matchIndex].removeAttribute("href");uword.baseParents[matchIndex]=uword.baseMatches[matchIndex].parentNode;uword.baseParents[matchIndex].removeChild(uword.baseMatches[matchIndex])}resetConstants();var cmID="";if(cm>0){cmID="_"+cm}var ul=getDataUl(uword,"data-ul"+cmID);if(options.addSearch=="true"){if(!((ul.nosearch)&&(ul.nosearch=="true"))){if(options.seperateSearch=="true"){if(ul.URLS["searchgoogle"]==undefined){ul.URLS["searchgoogle"]=[{URL:"http://www.google.com/search?q="+uword.textContent}]}if(ul.URLS["searchyahoo"]==undefined){ul.URLS["searchyahoo"]=[{URL:"http://search.yahoo.com/search?p="+uword.textContent}]}if(ul.URLS["searchbing"]==undefined){ul.URLS["searchbing"]=[{URL:"http://www.bing.com/search?q="+uword.textContent}]}}else{var searchQuery=options.searchURL+uword.textContent;if((ul.URLS["searchgoogle"]==undefined)&&(ul.URLS["searchyahoo"]==undefined)&&(ul.URLS["searchbing"]==undefined)){ul.URLS["search"]=[{URL:searchQuery}]}}}}var numOfImageLinks=0;var numOfNormalLinks=0;var numOfAppLinks=0;var numOfBuyLinks=0;var numOfSocialLinks=0;var numOfRefLinks=0;var numOfVideoLinks=0;var numOfAnnotationLinks=0;var numOfSearchLinks=0;var imageLinks={};var normalLinks={};var appLinks={};var buyLinks={};var socialLinks={};var refLinks={};var videoLinks={};var annotationLinks={};var searchLinks={};var numOfButtons=0;var maxNumOfLikeButtons=0;for(var type in ul.URLS){var typeURLS=ul.URLS[type];var url=undefined;for(var l=0;l<options.userLanguageOrder.length;l++){var language=options.userLanguageOrder[l];for(var u=0;u<typeURLS.length;u++){if(language==typeURLS[u].language){for(var c=0;c<options.userCountryOrder.length;c++){var country=options.userCountryOrder[c];for(var u2=0;u2<typeURLS.length;u2++){if((language==typeURLS[u2].language)&&(country==typeURLS[u2].country)){url=typeURLS[u2];break}}if(url!=undefined){break}}if(url!=undefined){break}else{for(var u3=0;u3<typeURLS.length;u3++){if((language==typeURLS[u3].language)&&(typeURLS[u3].country==undefined)){url=typeURLS[u2];break}}}if(url!=undefined){break}url=typeURLS[u];break}}if(url!=undefined){break}}if(url==undefined){for(var c=0;c<options.userCountryOrder.length;c++){var country=options.userCountryOrder[c];for(var u2=0;u2<typeURLS.length;u2++){if(country==typeURLS[u2].country){url=typeURLS[u2];break}}if(url!=undefined){break}}}if(url==undefined){for(var u=0;u<typeURLS.length;u++){if(!typeURLS[u].language&&!typeURLS[u].country){url=typeURLS[u];break}}if((url==undefined)&&(typeURLS.length>0)){url=typeURLS[0]}}if(url!=undefined){if(window.location.href!=url.URL){switch(type){case"image":imageLinks[type]=url.URL;numOfImageLinks++;break;case"href":case"href2":case"href3":normalLinks[type]=url.URL;numOfNormalLinks++;numOfButtons++;break;case"appios":case"appmac":case"appwebos":case"appandroid":case"appwindows":appLinks[type]=url.URL;numOfAppLinks++;numOfButtons++;break;case"buy":case"buylinkshareapple":case"buyamazon":case"buyebay":buyLinks[type]=rewriteAffiliateLink(url.URL,type);numOfBuyLinks++;numOfButtons++;break;case"twitter":case"linkedin":case"googleplus":case"facebook":socialLinks[type]=url.URL;numOfSocialLinks++;numOfButtons++;break;case"wikipedia":case"mediawiki":case"imdb":case"github":case"freebase":case"angellist":case"manpage":case"map":case"mapgoogle":refLinks[type]=url.URL;numOfRefLinks++;numOfButtons++;break;case"video":case"videoyoutube":videoLinks[type]=url.URL;numOfVideoLinks++;numOfButtons++;break;case"annotation":annotationLinks[type]=url.URL;numOfAnnotationLinks++;numOfButtons++;break;case"search":case"searchgoogle":case"searchyahoo":case"searchbing":searchLinks[type]=url.URL;numOfSearchLinks++;numOfButtons++;break}}}}if(options.combineLikeButtons=="true"){if(numOfNormalLinks>1){numOfButtons-=numOfNormalLinks-1}if(numOfAppLinks>1){numOfButtons-=numOfAppLinks-1}if(numOfBuyLinks>1){numOfButtons-=numOfBuyLinks-1}if(numOfSocialLinks>1){numOfButtons-=numOfSocialLinks-1}if(numOfRefLinks>1){numOfButtons-=numOfRefLinks-1}if(numOfVideoLinks>1){numOfButtons-=numOfVideoLinks-1}if(numOfAnnotationLinks>1){numOfButtons-=numOfAnnotationLinks-1}if(numOfSearchLinks>1){numOfButtons-=numOfSearchLinks-1}}if(numOfNormalLinks>maxNumOfLikeButtons){maxNumOfLikeButtons=numOfNormalLinks}if(numOfAppLinks>maxNumOfLikeButtons){maxNumOfLikeButtons=numOfAppLinks}if(numOfBuyLinks>maxNumOfLikeButtons){maxNumOfLikeButtons=numOfBuyLinks}if(numOfSocialLinks>maxNumOfLikeButtons){maxNumOfLikeButtons=numOfSocialLinks}if(numOfRefLinks>maxNumOfLikeButtons){maxNumOfLikeButtons=numOfRefLinks}if(numOfVideoLinks>maxNumOfLikeButtons){maxNumOfLikeButtons=numOfVideoLinks}if(numOfAnnotationLinks>maxNumOfLikeButtons){maxNumOfLikeButtons=numOfAnnotationLinks}if(numOfSearchLinks>maxNumOfLikeButtons){maxNumOfLikeButtons=numOfSearchLinks}if(true){var fontSize=getStyle(uword,"fontSize");fSize=parseFloat(fontSize);if(fSize<lowerBoundSize){fSize=lowerBoundSize;fontSize=lowerBoundSize+"px"}var relativeSize=fSize/16;sizeConstants(relativeSize);buttonWidth=buttonLabelWidth;var iconSpace=fSize+buttonIconSpacing+buttonIconSpacing;buttonWidth+=iconSpace;uword.multipleUltralinks=false;var wordLineWidth=uword.offsetWidth;if(getDataUl(uword,"data-ul"+cmID)){wordLineWidth+=iconSpace;if(getDataUl(uword,"data-ul_1")){wordLineWidth+=fSize+buttonIconSpacing;uword.multipleUltralinks=true}}var popupWidth=buttonWidth;if(wordLineWidth+rectHoleOutsetX*2>popupWidth){buttonWidth=wordLineWidth+rectHoleOutsetX*2;popupWidth=wordLineWidth+rectHoleOutsetX*2}popupWidth+=rectPopupOffsetX*2;var popupHeight=rectPopupOffsetY+uword.offsetHeight+(rectHoleOutsetY*2)+buttonSpacing+(buttonHeight+buttonSpacing)*numOfButtons+12;popupWidth+=4;uword.thumbnailH=0;uword.actualThumbnailH=0;if(numOfImageLinks>0){uword.thumbnailH=(3+buttonWidth+rectPopupOffsetY+rectPaddingY/2)}var truePosition=cumulativeOffset(uword);uword.trueOffsetLeft=truePosition[0];uword.trueOffsetTop=truePosition[1];uword.popupX=uword.trueOffsetLeft-rectPopupOffsetX-rectHoleOutsetX-rectPaddingX;uword.popupY=uword.trueOffsetTop-rectPopupOffsetY-rectHoleOutsetY-rectPaddingY-uword.thumbnailH;if(!uword.paper){uword.paper=new Raphael(uword.popupX-1,uword.popupY,popupWidth+rectPaddingX*2,popupHeight+rectPaddingY+uword.thumbnailH+rectPaddingX)}var P=uword.paper;var innerRRectCorner=rectRoundedCorner;if(innerRRectCorner>(uword.offsetHeight+(rectHoleOutsetY*2))/2){innerRRectCorner=(uword.offsetHeight+(rectHoleOutsetY*2))/2}var popupPercent=(numOfButtons-0.5)/(numOfButtons+1);if(numOfButtons==0){popupPercent=0.1}P.myRrect=P.path(rrectPath(rectPaddingX,rectPaddingY+uword.thumbnailH,popupWidth,popupHeight,rectRoundedCorner)+rrectPath2(rectPopupOffsetX+rectPaddingX+1,rectPopupOffsetY+rectPaddingY+uword.thumbnailH,uword.offsetWidth+(rectHoleOutsetX*2),uword.offsetHeight+(rectHoleOutsetY*2),innerRRectCorner));P.myRrect.attr("opacity",0.9);P.myRrect.attr("fill","90-"+rectTopColor+":"+(popupPercent*100)+"-"+rectBottomColor);P.myRrect.attr("stroke",rectStrokeColor);P.myRrect.attr("stroke-opacity",generalOpacity);P.myRrect.attr("stroke-width",rectStrokeWidth);P.myRrect.node.style.stroke=rectStrokeColor;P.myRrect.node.style.fill=P.myRrect.node.getAttribute("fill");P.myRrect.node.parentNode.style.setProperty("-webkit-font-smoothing","subpixel-antialiased");P.myRrect.node.parentNode.style.zIndex="2147483645";P.ULButtons=[];P.ULLabels=[];P.ULImages=[];P.ULImageBacks=[];P.ULImageNumbers=[];var widestButton=buttonWidth;var xButtonOffset=rectPopupOffsetX+rectPaddingX+2;var yButtonOffset=rectPopupOffsetY+uword.offsetHeight+(rectHoleOutsetY*2)+rectPaddingY+uword.thumbnailH+buttonSpacing+6;var yLabelOffset=yButtonOffset+buttonHeight/2;var buttonNum=0;function makeTypeButtons(theLinks,numLinks,labelName){var interiorWidth=0;function makeULButton(actualLinks){var nuButton=P.rect(xButtonOffset+1,yButtonOffset-4,buttonWidth-2,1);if(buttonNum==0){nuButton.attr("opacity",0)}else{var lightEnd=238;var darkEnd=221;if(buttonNum>1){lightEnd-=(buttonNum/(numOfButtons-2))*12;darkEnd-=(buttonNum/(numOfButtons-2))*12}nuButton.attr("opacity",1);nuButton.attr("fill","0-rgb("+darkEnd+","+darkEnd+","+darkEnd+")-#aaa:"+40+"-#aaa:"+60+"-rgb("+lightEnd+","+lightEnd+","+lightEnd+")")}nuButton.attr("stroke-opacity",0);buttonNum++;nuButton.bX=xButtonOffset;nuButton.bY=yButtonOffset;nuButton.bW=buttonWidth;nuButton.bH=buttonHeight;var firstType;var firstURL;for(var fType in actualLinks){firstType=fType;firstURL=actualLinks[firstType];break}function makeULLabel(x){var nuLabel=P.text(x,yLabelOffset,labelName);nuLabel.attr("text-anchor","start");nuLabel.attr("fill",buttonLabelColor);var tspans=nuLabel.node.getElementsByTagNameNS("http://www.w3.org/2000/svg","tspan");for(var i=0;i<tspans.length;i++){var tspan=tspans.item(i);tspan.style.setProperty("font-family","Open Sans, Arial");tspan.style.setProperty("font-weight","bold");tspan.style.setProperty("font-size",(fSize*fontShrinkage)+"px");if(isWebkit){var blueAlpha=0.25;var blackAlpha=0.4;tspan.style.setProperty("text-shadow","rgba(0,0,0,"+labelTextShadowOpacity+") 0 1px "+labelTextShadowRadius+", rgba(0,0,0,"+blackAlpha+") -1px  0px 1px, rgba(0,0,0,"+blackAlpha+") -1px  2px 1px, rgba(0,0,0,"+blackAlpha+")  1px  2px 1px, rgba(0,0,0,"+blackAlpha+")  1px  0px 1px, rgba(0,0,255,"+blueAlpha+") -1px -1px 1px, rgba(0,0,255,"+blueAlpha+") -1px  1px 1px, rgba(0,0,255,"+blueAlpha+")  1px  1px 1px, rgba(0,0,255,"+blueAlpha+")  1px -1px 1px")}}return nuLabel}function makeULLabel2(x,y){var s=document.createElement("span");s.className="ultralinkLink";s.textContent=labelName;s.style.setProperty("font-size",(fSize*fontShrinkage)+"px");s.style.setProperty("top","-1000px");s.style.setProperty("left","-1000px");document.body.appendChild(s);var yAdjust=0;if(isChrome||isFirefox){yAdjust=-1}s.style.setProperty("top",(y-s.offsetHeight/2+yAdjust)+"px");s.style.setProperty("left",x+"px");return s}var totalIconSpace=buttonIconSpacing;var imagek=P.ULImages.length;var imageNumber=0;for(var type in actualLinks){var actualType=type;var URL=actualLinks[actualType];var yAdjust=0;if(isSafari||isOpera){yAdjust=1}else{if(isChrome||isFirefox){yAdjust=0.5}}var theRR=document.createElement("div");theRR.className="ultralinkLinkImageBackNoPreview";theRR.style.setProperty("top",((uword.popupY+yLabelOffset-(fSize/2))-1+yAdjust)+"px");theRR.style.setProperty("left",((uword.popupX+xButtonOffset+totalIconSpace)-1)+"px");theRR.style.setProperty("width",(fSize+2)+"px");theRR.style.setProperty("height",(fSize+2)+"px");theRR.style.setProperty("border-radius",(fSize*0.17742)+"px");document.body.appendChild(theRR);var theULAnchor=document.createElement("a");theULAnchor.className="ultralinkLinkImageLink";theULAnchor.style.setProperty("top",((uword.popupY+yLabelOffset-(fSize/2))+yAdjust)+"px");theULAnchor.style.setProperty("left",((uword.popupX+xButtonOffset+totalIconSpace))+"px");var theULImage=document.createElement("img");theULImage.className="ultralinkLinkImage";theULImage.src=options.imagesURL+actualType.replace(RegExp("[0-9]$","g"),"")+"Link"+linkImageSize(fSize)+".png";theULImage.style.setProperty("width",fSize+"px");theULImage.style.setProperty("height",fSize+"px");theULAnchor.appendChild(theULImage);theULAnchor.outline=theRR;theULAnchor.image=theULImage;theULAnchor.linkType=type;theULAnchor.URL=URL;theULAnchor.nuButton=nuButton;document.body.appendChild(theULAnchor);setAsLinkAnchor(theULAnchor,URL,actualType,ul.category,uword.textContent,ul.database,ul.ID);if((jQ.inArray(theULAnchor.linkType,supportedInlineTypes)!=-1)&&(options.inlinePopups=="true")){theULAnchor.UMActionType="blackShadow";theRR.previewAvailable=true;theULAnchor.setAttribute("href","");theULAnchor.removeAttribute("href");if(uword.autoPopup==theULAnchor.linkType){var autoType=theULAnchor.linkType;var autoURL=theULAnchor.URL;var auto=theULAnchor;setTimeout(function(){createInlinePopup(autoType,autoURL,auto)},100)}else{if(theULAnchor.linkType=="wikipedia"){if((numOfRefLinks==1)||((numOfRefLinks==2)&&(refLinks.freebase!=undefined))){if((numOfNormalLinks==0)&&(numOfAppLinks==0)&&(numOfBuyLinks==0)&&(numOfSocialLinks==0)&&(numOfVideoLinks==0)&&(numOfAnnotationLinks==0)){var loneType=theULAnchor.linkType;var loneURL=theULAnchor.URL;var lone=theULAnchor;setTimeout(function(){lone.UMActionType="blueShadow";lone.outline.className="ultralinkLinkImageBackNoPreview";createInlinePopup(loneType,loneURL,lone)},100)}}}else{if(theULAnchor.linkType=="annotation"){var output={};parse_str(parse_url(theULAnchor.URL,"PHP_URL_QUERY"),output);if(output.auto){var annType=theULAnchor.linkType;var annURL=theULAnchor.URL;var ann=theULAnchor;setTimeout(function(){ann.UMActionType="blueShadow";ann.outline.className="ultralinkLinkImageBackNoPreview";createInlinePopup(annType,annURL,ann)},100)}}}}}else{theULAnchor.UMActionType="blueShadow";theRR.previewAvailable=false}attachClickRecorder(theULAnchor);P.ULImages[imagek]=theULAnchor;P.ULImageBacks[imagek]=theRR;imagek++;imageNumber++;totalIconSpace+=fSize+buttonIconSpacing}P.ULImageNumbers.push(imageNumber);if(options.iconSide=="left"){nuButton.ulLabel=makeULLabel2(uword.popupX+xButtonOffset+totalIconSpace-2,uword.popupY+yLabelOffset)}else{if(options.iconSide=="right"){nuButton.ulLabel=makeULLabel2(uword.popupX+xButtonOffset+buttonIconSpacing-2,uword.popupY+yLabelOffset)}}var theULLabel=nuButton.ulLabel;P.ULLabels.push(theULLabel);interiorWidth=(buttonIconSpacing*2)+theULLabel.offsetWidth;interiorWidth+=(fSize+buttonIconSpacing)*numLinks;if(interiorWidth>widestButton){widestButton=interiorWidth}yButtonOffset+=buttonHeight+buttonSpacing;yLabelOffset=yButtonOffset+buttonHeight/2;return nuButton}if((numLinks>1)&&(options.combineLikeButtons=="true")){P.ULButtons.push(makeULButton(theLinks))}else{for(type in theLinks){if(type in ULLinkTypes){var url=theLinks[type];var actualLinks={};actualLinks[type]=url;labelName=ULLinkTypes[type];if((type=="href")||(type=="href2")||(type=="href3")){labelName=getDomain(url)}if(type=="annotation"){var output={};parse_str(parse_url(url,"PHP_URL_QUERY"),output);if(output.label){labelName=output.label}}P.ULButtons.push(makeULButton(actualLinks))}}}}if(numOfButtons){var buttonsOutline2=P.path(rrectPath(xButtonOffset,rectPopupOffsetY+uword.offsetHeight+(rectHoleOutsetY*2)+rectPaddingY+uword.thumbnailH+buttonSpacing+2,buttonWidth,P.ULButtons.length*(buttonHeight+buttonSpacing)-buttonSpacing+8,buttonRoundedCorner));var buttonsOutline=P.path(rrectPath(xButtonOffset,rectPopupOffsetY+uword.offsetHeight+(rectHoleOutsetY*2)+rectPaddingY+uword.thumbnailH+buttonSpacing+2,buttonWidth,P.ULButtons.length*(buttonHeight+buttonSpacing)-buttonSpacing+8,buttonRoundedCorner))}makeTypeButtons(normalLinks,numOfNormalLinks,"Links");makeTypeButtons(appLinks,numOfAppLinks,"App");makeTypeButtons(buyLinks,numOfBuyLinks,"Buy");makeTypeButtons(socialLinks,numOfSocialLinks,"Social");makeTypeButtons(refLinks,numOfRefLinks,"Reference");makeTypeButtons(videoLinks,numOfVideoLinks,"Video");makeTypeButtons(annotationLinks,numOfAnnotationLinks,"Annotation");makeTypeButtons(searchLinks,numOfSearchLinks,"Search");if(widestButton>buttonWidth){var thumbnailDelta=uword.thumbnailH;buttonWidth=widestButton;popupWidth=widestButton+rectPopupOffsetX*2;popupWidth+=4;if(numOfImageLinks>0){uword.thumbnailH=(3+buttonWidth+rectPopupOffsetY+rectPaddingY/2)}else{uword.thumbnailH=0}thumbnailDelta=uword.thumbnailH-thumbnailDelta;P.canvas.style.setProperty("top",(parseFloat(P.canvas.style.top)-thumbnailDelta)+"px");P.setSize(popupWidth+rectPaddingX*2,popupHeight+rectPaddingY+uword.thumbnailH+rectPaddingX);uword.popupX=uword.trueOffsetLeft-rectPopupOffsetX-rectHoleOutsetX-rectPaddingX;uword.popupY=uword.trueOffsetTop-rectPopupOffsetY-rectHoleOutsetY-rectPaddingY-uword.thumbnailH;P.myRrect.attr("path",rrectPath(rectPaddingX,rectPaddingY+uword.thumbnailH,popupWidth,popupHeight,rectRoundedCorner)+rrectPath2(rectPopupOffsetX+rectPaddingX+1,rectPopupOffsetY+rectPaddingY+uword.thumbnailH,uword.offsetWidth+(rectHoleOutsetX*2),uword.offsetHeight+(rectHoleOutsetY*2),innerRRectCorner));var k;var imagek=0;for(k=0;k<P.ULButtons.length;k++){var yBO=rectPopupOffsetY+uword.offsetHeight+(rectHoleOutsetY*2)+rectPaddingY+uword.thumbnailH+buttonSpacing+(buttonHeight+buttonSpacing)*k+6;P.ULButtons[k].attr("x",xButtonOffset+1);P.ULButtons[k].attr("y",yBO-4);P.ULButtons[k].attr("width",buttonWidth-2);P.ULButtons[k].attr("height",1);P.ULButtons[k].bX=xButtonOffset+1;P.ULButtons[k].bY=yBO-4;P.ULButtons[k].bW=buttonWidth-2;P.ULButtons[k].bH=1;P.ULLabels[k].style.setProperty("y",P.ULLabels[k].style.y+thumbnailDelta);for(var ik=0;ik<P.ULImageNumbers[k];ik++){P.ULImages[imagek].style.setProperty("y",(P.ULImages[imagek].style.y+thumbnailDelta)+"px");P.ULImageBacks[imagek].style.setProperty("y",(P.ULImageBacks[imagek].style.y+thumbnailDelta)+"px");imagek++}}}if(numOfButtons){buttonsOutline2.attr("path",rrectPath(xButtonOffset-0.5,rectPopupOffsetY+uword.offsetHeight+(rectHoleOutsetY*2)+rectPaddingY+uword.thumbnailH+buttonSpacing+2+0.5,buttonWidth,P.ULButtons.length*(buttonHeight+buttonSpacing)-buttonSpacing+8,buttonRoundedCorner));buttonsOutline2.attr("opacity",0);buttonsOutline2.attr("fill","60-"+rectBottomColor+":"+0.9+"-#eee");buttonsOutline2.attr("stroke-opacity",0);buttonsOutline2.node.style.fill=buttonsOutline2.node.getAttribute("fill");buttonsOutline.attr("path",rrectPath(xButtonOffset,rectPopupOffsetY+uword.offsetHeight+(rectHoleOutsetY*2)+rectPaddingY+uword.thumbnailH+buttonSpacing+2,buttonWidth,P.ULButtons.length*(buttonHeight+buttonSpacing)-buttonSpacing+8,buttonRoundedCorner));buttonsOutline.attr("fill","60-"+rectTopColor+":"+0.9+"-"+rectBottomColor);buttonsOutline.attr("stroke-opacity",0);buttonsOutline.node.style.fill=buttonsOutline.node.getAttribute("fill")}if(options.iconSide=="right"){var k;var imagek=0;for(k=0;k<P.ULButtons.length;k++){for(var ik=0;ik<P.ULImageNumbers[k];ik++){P.ULImages[imagek].style.setProperty("left",(parseFloat(P.ULImages[imagek].style.left)+buttonWidth-(P.ULImageNumbers[k]*(fSize+buttonIconSpacing))-buttonIconSpacing)+"px");P.ULImageBacks[imagek].style.setProperty("left",(parseFloat(P.ULImageBacks[imagek].style.left)+buttonWidth-(P.ULImageNumbers[k]*(fSize+buttonIconSpacing))-buttonIconSpacing)+"px");imagek++}}}var k;var imagek=0;for(k=0;k<P.ULButtons.length;k++){for(var ik=0;ik<P.ULImageNumbers[k];ik++){if(P.ULImageBacks[imagek].previewAvailable==true){P.ULImageBacks[imagek].className="ultralinkLinkImageBackPreview"}else{P.ULImageBacks[imagek].className="ultralinkLinkImageBackNoPreview"}imagek++}}if(ul.ID){var yAdjust=0;if(isSafari||isOpera){yAdjust=1}else{if(isChrome||isFirefox){yAdjust=0.5}}var theRR=document.createElement("div");theRR.className="ultralinkLinkImageBackPreview";theRR.style.setProperty("top",(uword.popupY+(rectPopupOffsetY+rectPaddingY+uword.thumbnailH+(uword.offsetHeight+(rectHoleOutsetY*2)-fSize)/2-1)+yAdjust)+"px");theRR.style.setProperty("left",(uword.popupX+(popupWidth-fSize-buttonSpacing/2-buttonIconSpacing-2)-1)+"px");theRR.style.setProperty("width",(fSize+2)+"px");theRR.style.setProperty("height",(fSize+2)+"px");theRR.style.setProperty("border-radius",(fSize*0.17742)+"px");document.body.appendChild(theRR);var theULAnchor=document.createElement("a");theULAnchor.className="ultralinkLinkImageLink";theULAnchor.style.setProperty("top",((uword.popupY+rectPopupOffsetY+rectPaddingY+uword.thumbnailH+(uword.offsetHeight+(rectHoleOutsetY*2)-fSize)/2)+yAdjust)+"px");theULAnchor.style.setProperty("left",((uword.popupX+popupWidth-fSize-buttonSpacing/2-buttonIconSpacing-2))+"px");var theULImage=document.createElement("img");theULImage.className="ultralinkLinkImage";theULImage.src=options.imagesURL+"ultralinkmeLink"+linkImageSize(fSize)+".png";theULImage.style.setProperty("width",fSize+"px");theULImage.style.setProperty("height",fSize+"px");theULAnchor.appendChild(theULImage);theULAnchor.outline=theRR;theULAnchor.image=theULImage;var theDatabase="";if(ul.database){theDatabase=ul.database+"/"}var umURL="https://ultralink.me/description/"+theDatabase+ul.ID+"?word="+encodeURIComponent(uword.textContent);theULAnchor.linkType="ultralinkme";theULAnchor.URL=umURL;document.body.appendChild(theULAnchor);P.umLink=theULAnchor;setAsLinkAnchor(P.umLink,umURL,"ultralinkme",ul.category,uword.textContent,ul.database,ul.ID);if(options.inlinePopups=="true"){P.umLink.UMActionType="blackShadow";theRR.previewAvailable=true;theRR.className="ultralinkLinkImageBackPreview";P.umLink.setAttribute("href","");P.umLink.removeAttribute("href")}else{P.umLink.UMActionType="blueShadow";theRR.previewAvailable=false;theRR.className="ultralinkLinkImageBackNoPreview"}attachClickRecorder(P.umLink);if(uword.multipleUltralinks==true){var circleX=rectPopupOffsetX+rectPaddingX+uword.offsetWidth+(rectHoleOutsetX*2)+fSize/2+buttonIconSpacing*0.87;var circleY=rectPopupOffsetY+rectPaddingY+uword.thumbnailH+(uword.offsetHeight+(rectHoleOutsetY*2))/2;P.nextUltralink=P.circle(circleX,circleY,fSize/2);P.nextUltralink.attr("opacity",generalOpacity);P.nextUltralink.attr("cursor","pointer");P.nextUltralink.attr("stroke-width",nextStrokeOutlineWidth);P.nextUltralink.attr("stroke",nextStrokeColor);P.nextUltralink.attr("fill","90-#ddd:"+50+"-#eee");P.nextUltralink.mouseup(function(event){alternatePopup(uword,cm)});P.nextUltralink.node.style.stroke=nextStrokeColor;P.nextUltralink.node.style.fill=P.nextUltralink.node.getAttribute("fill");var nextShadow=P.nextUltralink.glow({color:rectGlowColor,width:nextGlowWidth,opacity:nextGlowOpacity,offsety:0});for(var ns=0;ns<nextShadow.length;ns++){nextShadow[ns].node.style.stroke=nextShadow[ns].node.getAttribute("stroke")}P.nextArrow=P.path("M"+(circleX-fSize/4+fSize/8)+","+(circleY-fSize/4)+" L"+(circleX+fSize/8)+","+circleY+" L"+(circleX-fSize/4+fSize/8)+","+(circleY+fSize/4));P.nextArrow.attr("stroke-width",nextStrokeArrowWidth);P.nextArrow.attr("stroke",nextArrowStrokeColor);P.nextArrow.attr("cursor","pointer");P.nextArrow.mouseup(function(event){alternatePopup(uword,cm)});P.nextArrow.node.style.stroke=nextArrowStrokeColor;P.nextArrow.node.style.fill=P.nextArrow.node.getAttribute("fill")}}P.myRrect.rectShadow=P.myRrect.glow({color:rectGlowColor,width:rectGlowWidth,opacity:rectGlowOpacity,offsety:rectGlowOffsetY});for(var rs=0;rs<P.myRrect.rectShadow.length;rs++){P.myRrect.rectShadow[rs].node.style.stroke=P.myRrect.rectShadow[rs].node.getAttribute("stroke")}if(numOfImageLinks>0){var imageURLS=ul.URLS["image"];var im=0;function createThumbnail(){var theImageURLInfo=imageURLS[im];if(theImageURLInfo!=undefined){var imageURL=theImageURLInfo.URL;var thumbnail=new Image();thumbnail.roundedCorners="true";if(theImageURLInfo.roundedCorners){thumbnail.roundedCorners=theImageURLInfo.roundedCorners}function setThumbnail(tN){if(uword==currentUword){var baseMatches2=document.querySelectorAll("base[href]");var baseParents2=[];var baseHrefs2=[];for(var matchIndex=0;matchIndex<baseMatches2.length;matchIndex++){baseHrefs2[matchIndex]=baseMatches2[matchIndex].getAttribute("href");baseMatches2[matchIndex].removeAttribute("href");baseParents2[matchIndex]=baseMatches2[matchIndex].parentNode;baseParents2[matchIndex].removeChild(baseMatches2[matchIndex])}var wOffset=0;var hOffset=0;var nuWidth=tN.width;var nuHeight=tN.height;var bW=buttonWidth+3;uword.actualThumbnailH=uword.thumbnailH;if(nuWidth>nuHeight){nuHeight*=bW/nuWidth;nuWidth=bW;hOffset=(bW-nuHeight);uword.actualThumbnailH=nuHeight+rectPopupOffsetY+rectPaddingY/2}else{nuWidth*=bW/nuHeight;nuHeight=bW;wOffset=(bW-nuWidth)/2}if((uword.popupY<5)&&(nuHeight>(bW-(5-uword.popupY)))){var adjustedHeight=bW-(5-uword.popupY);adjustmentRatio=adjustedHeight/nuHeight;nuHeight*=adjustmentRatio;nuWidth*=adjustmentRatio;hOffset=(bW-nuHeight);wOffset=(bW-nuWidth)/2;uword.actualThumbnailH=nuHeight+rectPopupOffsetY+rectPaddingY/2}if(!((nuWidth/bW<0.3)&&(nuHeight/bW<0.3))){if(P.ULback){P.ULback.remove()}P.ULback=P.ellipse(rectPopupOffsetX+rectPaddingX+wOffset+nuWidth/2,rectPopupOffsetY+rectPaddingY+hOffset+nuHeight/2,nuWidth/2,nuHeight/2);P.ULback.attr("fill","r"+rectBottomColor+"-"+rectBottomColor+"-"+rectBottomColor+"-"+rectBottomColor);P.ULback.attr("opacity",0);P.ULback.attr("stroke-opacity",0);if(P.ULthumbnail){P.ULthumbnail.remove()}P.ULthumbnail=P.image(tN.src,rectPopupOffsetX+rectPaddingX+wOffset,rectPopupOffsetY+rectPaddingY+hOffset,nuWidth,nuHeight);P.myRrect.attr("path",rrectPath(rectPaddingX,rectPaddingY+(uword.thumbnailH-uword.actualThumbnailH),popupWidth,popupHeight+uword.actualThumbnailH,rectRoundedCorner)+rrectPath2(rectPopupOffsetX+rectPaddingX+1,rectPopupOffsetY+rectPaddingY+uword.thumbnailH,uword.offsetWidth+(rectHoleOutsetX*2),uword.offsetHeight+(rectHoleOutsetY*2),innerRRectCorner));P.myRrect.getBBox();var fullToPopupRatio=(popupHeight+uword.actualThumbnailH)/(popupHeight);var gradientPercent=(popupPercent/fullToPopupRatio)*100;P.myRrect.attr("fill","90-"+rectTopColor+":"+gradientPercent+"-"+rectBottomColor);P.myRrect.node.style.fill=P.myRrect.node.getAttribute("fill");P.myRrect.rectShadow.remove();P.myRrect.rectShadow=P.myRrect.glow({color:rectGlowColor,width:rectGlowWidth,opacity:rectGlowOpacity,offsety:rectGlowOffsetY});for(var rs=0;rs<P.myRrect.rectShadow.length;rs++){P.myRrect.rectShadow[rs].node.style.stroke=P.myRrect.rectShadow[rs].node.getAttribute("stroke")}if(tN.roundedCorners=="true"){jQ("#imageClippath",P.canvas).remove();var SVG_NS="http://www.w3.org/2000/svg";var cpe=document.createElementNS(SVG_NS,"clipPath");cpe.setAttribute("id","imageClippath");P.theR=document.createElementNS(SVG_NS,"rect");P.theR.setAttribute("x",rectPopupOffsetX+rectPaddingX+wOffset);P.theR.setAttribute("y",rectPopupOffsetY+rectPaddingY+hOffset);P.theR.setAttribute("rx",imageRoundedCorner);P.theR.setAttribute("ry",imageRoundedCorner);P.theR.setAttribute("width",nuWidth);P.theR.setAttribute("height",nuHeight);cpe.appendChild(P.theR);P.canvas.appendChild(cpe);P.ULthumbnail.node.setAttribute("clip-path","url(#imageClippath)")}P.ULthumbnail.attr("cursor","pointer");function thumbnailCycle(direction){if(ulThumbnails.length>1){ulThumbnailIndex+=direction;if(ulThumbnailIndex<0){ulThumbnailIndex=ulThumbnails.length-1}else{if(ulThumbnailIndex>=ulThumbnails.length){ulThumbnailIndex=0}}setThumbnail(ulThumbnails[ulThumbnailIndex])}}P.ULthumbnail.click(function(event){var direction=1;if(event.pageX<uword.popupX+popupWidth/2){direction=-1}if(ulThumbnailInterval!=undefined){clearInterval(ulThumbnailInterval);ulThumbnailInterval=undefined;slideshowOn=false}thumbnailCycle(direction)});if((ulThumbnailInterval==undefined)&&(slideshowOn)){ulThumbnailInterval=setInterval(function(){if(slideshowOn){thumbnailCycle(1)}},5000)}}else{uword.actualThumbnailH=0}for(var matchIndex=0;matchIndex<baseMatches2.length;matchIndex++){baseMatches2[matchIndex].setAttribute("href",baseHrefs2[matchIndex]);baseParents2[matchIndex].appendChild(baseMatches2[matchIndex])}im++;createThumbnail()}}thumbnail.onload=function(){if((thumbnail.width!=0)&&(thumbnail.height!=0)){ulThumbnails[ulThumbnails.length]=thumbnail;if(ulThumbnails.length==1){setThumbnail(thumbnail)}}else{uword.actualThumbnailH=0;im++;createThumbnail()}};thumbnail.onerror=function(){uword.actualThumbnailH=0;im++;createThumbnail()};thumbnail.src=imageURL}else{if(ulThumbnails.length<2){P.ULthumbnail.attr("cursor","")}}}createThumbnail()}setTimeout(function(){if((ul.ID&&(ul.ID==-1))||(uword.autoPopup=="ultralinkme")){setInlineULImage(P.umLink)}},100);checkReposition(uword,250)}else{currentUword=undefined}}}function recordClick(event,target){var actionType=target.parentNode.UMActionType;if(!actionType){actionType=target.parentNode.parentNode.UMActionType}var type=target.parentNode.UMType;if(!type){type=target.parentNode.parentNode.UMType}var category=target.parentNode.UMCategory;if(!category){category=target.parentNode.parentNode.UMCategory}var database=target.parentNode.UMDatabase;if(!database){database=target.parentNode.parentNode.UMDatabase}var ID=target.parentNode.UMID;if(!ID){ID=target.parentNode.parentNode.UMID}var URL=target.parentNode.UMUrl;if((URL==undefined)||(URL==null)){URL=target.parentNode.parentNode.UMUrl}if((URL==undefined)||(URL==null)){URL=target.UMUrl}var word=target.parentNode.UMWord;if((word==undefined)||(word==null)){word=target.parentNode.parentNode.UMWord}if((word==undefined)||(word==null)){word=target.UMword}var clickType="addClickHyperlink";if(type){clickType="addClick"}var sendString="ULWord="+encodeURIComponent(word)+"&ULLink="+encodeURIComponent(URL)+"&ULReferrer="+encodeURIComponent(window.location.href)+"&ULReferrerTitle="+encodeURIComponent(document.title)+"&ActionType="+encodeURIComponent(actionType);if(type){sendString+="&ULType="+encodeURIComponent(type)}if(category){sendString+="&ULCategory="+encodeURIComponent(category)}if(database){sendString+="&ULDatabase="+encodeURIComponent(database)}if(ID){sendString+="&ULID="+encodeURIComponent(ID)}sendString+="&associatedWebsite="+encodeURIComponent(options.associatedWebsite);if(actionType=="blackShadow"){if(isFirefox||isOpera||touchInterface){jQ.ajax({async:false,type:"GET",url:analyticsInterface+clickType,data:sendString,dataType:"json"})}else{jQ.ajax({async:false,type:"GET",url:analyticsInterface+clickType,data:sendString,dataType:"jsonp"})}}else{if(actionType=="blueShadow"){if(isFirefox||isOpera||touchInterface){target.alreadyTracked="true";jQ.ajax({async:false,type:"GET",url:analyticsInterface+clickType,data:sendString,dataType:"json"})}else{if(isIE){jQ.ajax({async:false,type:"GET",url:analyticsInterface+clickType,data:sendString,dataType:"jsonp"});sleep(300)}else{target.alreadyTracked="true";jQ.ajax({async:false,type:"GET",url:analyticsInterface+clickType,data:sendString,dataType:"jsonp"});setTimeout(function(){var evt=document.createEvent("MouseEvents");evt.initMouseEvent(event.type,event.bubbles,event.cancelable,event.view,event.detail,event.screenX,event.screenY,event.clientX,event.clientY,event.ctrlKey,event.altKey,event.shiftKey,event.metaKey,event.button,event.relatedTarget);target.dispatchEvent(evt)},100)}}}}}function recordPopupClick(category,database,ID,word){var clickType="addClick";var sendString="ULWord="+encodeURIComponent(word)+"&ULReferrer="+encodeURIComponent(window.location.href)+"&ULReferrerTitle="+encodeURIComponent(document.title)+"&ActionType="+encodeURIComponent("popup");if(category){sendString+="&ULCategory="+encodeURIComponent(category)}if(database){sendString+="&ULDatabase="+encodeURIComponent(database)}if(ID){sendString+="&ULID="+encodeURIComponent(ID)}sendString+="&associatedWebsite="+encodeURIComponent(options.associatedWebsite);if(isFirefox||isOpera||touchInterface){jQ.ajax({async:false,type:"GET",url:analyticsInterface+clickType,data:sendString,dataType:"json"})}else{jQ.ajax({async:false,type:"GET",url:analyticsInterface+clickType,data:sendString,dataType:"jsonp"})}}function attachClickRecorder(thing){if(options.UMAnalytics=="true"){var theHREF=thing.getAttribute("href");if((theHREF==undefined)||(!theHREF.match(/^#/))){thing=jQ(thing);var clickAction="click";thing.bind(clickAction,function(e){if(e.alreadySeen!="true"){e.alreadySeen="true";if(e.target.alreadyTracked=="true"){delete e.target.alreadyTracked}else{e.target.UMUrl=e.target.href;e.target.UMWord=e.target.textContent;recordClick(e,e.target);if(e.target.parentNode.UMActionType=="blueShadow"){if(!(isFirefox||isIE||isOpera||touchInterface)){return false}}else{if(e.target.parentNode.UMActionType=="blackShadow"){setInlineULImage(e.target.parentNode)}}}}})}}}function detachClickRecorder(thing){var clickAction="click";thing.unbind(clickAction)}function checkNewUltralink(){if(currentUword!=undefined){var uword=currentUword;var eul=getDataUl(uword,"data-ul");if(eul&&(eul.ID<0)){var cnURL=APIInterface+"extension/getMostRecentDescription?word="+encodeURIComponent(uword.textContent);if(options.database!=""){cnURL+="&database="+encodeURIComponent(options.database)}jQ.ajax({type:"GET",url:cnURL,dataType:"json",success:function(data,textStatus,jqXHR){if(data>0){eul.ID=data;if(options.database!=""){eul.database=options.database}setDataUl(uword,"data-ul",eul)}}})}}}function alternatePopup(uword,cm){var nuInlineType=undefined;if(uword.inlinePaper){nuInlineType=uword.inlinePaper.linkType}removeOldPopup();uword.autoPopup=nuInlineType;cm++;if(getDataUl(uword,"data-ul_"+cm)){pendingPopup=uword;createPopup(uword,cm)}else{pendingPopup=uword;createPopup(uword)}}Ultralink.fragmentCallback=function(data){jQ('head script[src="https://ultralink.me'+data.URI+'"]').remove();var sURLHash=CryptoJS.SHA1("https://ultralink.me"+data.URI);if(Ultralink[sURLHash]!=undefined){Ultralink[sURLHash](data);delete Ultralink[sURLHash]}};function jsonpLoad(scriptURL,callback){var sURLHash=CryptoJS.SHA1(scriptURL);Ultralink[sURLHash]=callback;var head=document.getElementsByTagName("head")[0];var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src=scriptURL;head.appendChild(s)}function getPageContentSelectors(){var tagParagraphCounts={};var scanMatchNumber=0;var scanMatchVolume=0;var scanMatchVolumeNumber=0;var scanMatchParagraphs=0;var scanForNumber="";var scanForVolume="";var scanForParagraphs="";var scanFor="";var ulMatches=document.querySelectorAll(".ultralink");if(ulMatches.length>0){scanFor=".ultralink"}else{for(var i=0;i<hardcodedSites.length;i++){if(window.location.href.match(RegExp(hardcodedSites[i]["siteRegex"],"i"))){scanFor=hardcodedSites[i]["selector"];break}}if(scanFor==""){var tagTypes=["div.article","div.articleBody","div.articlePage","div.articleText","div.article-content","div.article-container","div.article-main","div.article-main-text","div.body","div.body-copy","div.bd","div.content","div.Content","div.contentBody","div.content-text","div.content-section","div.entry","div.entry-content","div.entry_body_text","div.ii","div.mainWrapper","div.main_col","div.main-content","div.media-story","div.mw-content-ltr","div.post","div.post-body","div.post_body","div.post-text","div.primary","div.story","div.story-text","div.storyText","div.wsh_expCol_Content","div#inner_content_left","div#articleText","div#articleBody","div#article-body-blocks","div#article_body","div#article_story_body","div#bodyContent","div#content","div#mediaarticlebody","div#story-body-text","div#story","div#storyContent","div.apple-rss-article-body","td.bod","td.text"];var matches;for(var t=0;t<tagTypes.length;t++){var tt=tagTypes[t];var matches=document.querySelectorAll(tt);for(var sectionIndex=0;sectionIndex<matches.length;sectionIndex++){var section=matches[sectionIndex];var sectionVolume=section.offsetHeight*section.offsetWidth;if(sectionVolume>scanMatchVolume){scanMatchVolume=sectionVolume;scanMatchVolumeNumber=matches.length;scanForVolume=tt}var paragraphMatches=document.querySelectorAll(tt+" p");tagParagraphCounts[tt]=paragraphMatches.length;if(paragraphMatches.length>scanMatchParagraphs){scanMatchParagraphs=paragraphMatches.length;scanForParagraphs=tt}}if(matches.length>scanMatchNumber){scanMatchNumber=matches.length;scanForNumber=tt}}if(scanForVolume==scanForParagraphs){scanFor=scanForVolume}else{if(scanForVolume==scanForNumber){scanFor=scanForVolume}else{if((scanForVolume!="")&&(scanMatchNumber==0)){scanFor=scanForVolume}else{if((scanForNumber!="")&&(scanMatchVolume==0)){scanFor=scanForNumber}else{if((scanMatchVolumeNumber==scanMatchNumber)&&(scanMatchVolumeNumber!=0)){scanFor=scanForVolume}else{if((scanMatchVolumeNumber==1)&&(scanMatchNumber>scanMatchVolumeNumber)){scanFor=scanForNumber}else{if(scanForVolume!=""){scanFor=scanForVolume}}}}}}}if(scanFor!=""){var winnerPCount=tagParagraphCounts[scanFor];if((winnerPCount!=undefined)&&(winnerPCount>2)){scanFor=scanFor+" p, "+scanFor+" ul, "+scanFor+" dl"}}}}if(scanFor==""){scanFor="p"}return scanFor}function replaceAnchor(section,word){var child=section.childNodes[0];var alreadyHasLink=false;if(word!=undefined){if(child.nodeType==Node.TEXT_NODE){for(var type in word.ul["URLS"]){var typeURLS=word.ul["URLS"][type];for(var m=0;m<typeURLS.length;m++){var urlEntry=typeURLS[m];var thisLink=document.createElement("a");thisLink.href=urlEntry.URL;if(getDomain(thisLink.href)==getDomain(section.href)){alreadyHasLink=true;break}}}var wul=word.ul;if(alreadyHasLink==false){wul={};jQ.extend(true,wul,word.ul);if(!wul.URLS["href2"]){wul.URLS["href2"]=[]}wul.URLS["href2"].push({URL:section.href})}var caseSensitive="i";if(word.caseSensitive==1){caseSensitive=""}var regex=new RegExp("^("+word.quotedWord+")$","g"+caseSensitive);var gotHit=false;var newText=child.nodeValue.replace(regex,function(match,p1,offset,string){gotHit=true;return"<uword>"+p1+"</uword>"});if(gotHit==true){var frag=document.createElement("span");frag.innerHTML=newText;var nuUword=frag.childNodes.item(0);section.parentNode.replaceChild(nuUword,section);setDataUl(nuUword,"data-ul",wul)}}}else{var flyWord={URLS:{}};var linkType="href";for(var detector in linkDetectors){if(section.href.match(RegExp(detector,"i"))){linkType=linkDetectors[detector];break}}flyWord.URLS[linkType]=[];flyWord.URLS[linkType].push({URL:section.href});if(options.editorStyle=="true"){flyWord.ID="-2"}var nuUword=document.createElement("uword");nuUword.innerHTML=section.innerHTML;section.parentNode.replaceChild(nuUword,section);setDataUl(nuUword,"data-ul",flyWord)}}function replaceInTextNode(section,word){var replacements=0;var caseSensitive="i";if(word.caseSensitive==1){caseSensitive=""}var children=section.childNodes;if(children){var regex=new RegExp("(\\b|\\s|\\.|\\+|\\*|\\?|\\[|\\^|\\]|\\$|\\(|\\)|\\{|\\}|\\=|\\!|\\<|\\>|\\||\\:|\\-|^)"+word.notgreedy+"("+word.quotedWord+")(\\b|\\s|\\.|\\+|\\*|\\?|\\[|\\^|\\]|\\$|\\(|\\)|\\{|\\}|\\=|\\!|\\<|\\>|\\||\\:|\\-|$)"+word.notgreedy,"g"+caseSensitive);var regex2=new RegExp("(?:\\b|\\s|\\.|\\+|\\*|\\?|\\[|\\^|\\]|\\$|\\(|\\)|\\{|\\}|\\=|\\!|\\<|\\>|\\||\\:|\\-|^)"+word.notgreedy+"(?:"+word.quotedWord+")(?:\\b|\\s|\\.|\\+|\\*|\\?|\\[|\\^|\\]|\\$|\\(|\\)|\\{|\\}|\\=|\\!|\\<|\\>|\\||\\:|\\-|$)"+word.notgreedy,"g"+caseSensitive);var index=children.length;while(--index>=0){var child=children[index];if(child.nodeType==Node.TEXT_NODE){var hitArray=[];child.nodeValue.replace(regex,function(match,p1,p2,p3,offset,string){var dollarOne="";if(p1!=undefined){dollarOne=p1}var dollarThree="";if(p3!=undefined){dollarThree=p3}hitArray.push(dollarOne+"<uword>"+p2+"</uword>"+dollarThree)});if(hitArray.length>0){var subStrs=child.nodeValue.split(regex2);for(var s=0;s<subStrs.length;s++){section.insertBefore(document.createTextNode(subStrs[s]),child);if(s<hitArray.length){var frag=document.createElement("span");frag.innerHTML=hitArray[s];while(frag.childNodes.length){var cn=frag.childNodes.item(0);if(cn.nodeName.toLowerCase()=="uword"){setDataUl(cn,"data-ul",word.ul);replacements++}section.insertBefore(cn,child)}}}section.removeChild(child)}}}}return replacements}var wikipediaURLRE=RegExp("http.*wikipedia.org/wiki/(?!(User|Wikipedia|File|MediaWiki|Template|Help|Category|Portal|Book|Education_Program|TimedText)(_talk)?:)","i");var firstPop=false;function injectUltralinks(section,data){if(data.words!=undefined){if(data.words.length>0){for(var w=0;w<data.words.length;w++){var caseSensitive="i";if(data.words[w].caseSensitive==1){caseSensitive=""}if(jQ(section).is(":not(span.nouword *):not(iframe *):not(a *)")){replaceInTextNode(section,data.words[w])}jQ(":not(span.nouword,iframe,a):not(span.nouword *):not(iframe *):not(a *):"+caseSensitive+"contains2("+data.words[w].word+")",section).each(function(){if(this.tagName.toLowerCase()=="uword"){var uword=this;if(uword.textContent.toLowerCase()==data.words[w].word.toLowerCase()){var ul=getDataUl(uword,"data-ul");if(ul==undefined){setDataUl(uword,"data-ul",data.words[w]["ul"])}else{var cID=0;var thisDatabase=ul.database;while(ul!=undefined){if(ul.ID==data.words[w].ID){cID=-1;break}cID++;ul=getDataUl(uword,"data-ul_"+cID)}if(cID>0){if(thisDatabase==data.words[w]["ul"]["database"]){setDataUl(uword,"data-ul_"+cID,data.words[w]["ul"])}}}}}else{replaceInTextNode(this,data.words[w])}});if(options.replaceHyperlinks=="true"){jQ("a:"+caseSensitive+"contains2("+data.words[w].word+")",section).each(function(){if(this.textContent.toLowerCase()==data.words[w].word.toLowerCase()){replaceAnchor(this,data.words[w])}})}}Ultralink.uwordScanPage(section)}}if(options.replaceHyperlinks=="true"){if((window.location.href.match(wikipediaURLRE))||(options.cleanMode=="true")){setTimeout(function(){jQ("a:not(.autonumber)",section).each(function(){if(this.textContent!=""){replaceAnchor(this)}});Ultralink.uwordScanPage(section)},100)}}section.finished=true;if(touchInterface){if(!firstPop){var allLoaded=true;var oneSectionInView=false;for(var s=0;s<sections.length;s++){var sec=sections[s];if(elementInView(sec)){oneSectionInView=true;if(!sec.finished){allLoaded=false}}}if(oneSectionInView&&allLoaded){firstPop=true;for(var s=0;s<sections.length;s++){var sec=sections[s];if(elementInView(sec)){jQ("uword",sec).each(function(){var ul=getDataUl(this,"data-ul");if(!(ul&&(ul.callout)&&(ul.callout=="normal"))){if(elementInView(this)){setRippleTransition(this,1)}}})}}}}}}function restartWithOverride(siteRegexp,overrideSelector){if((overrideSelector!=currentSelector)&&(currentSelector!=".ultralink")){var i=0;var found=false;while(i<hardcodedSites.length){if(hardcodedSites[i]["siteRegex"]==siteRegexp){hardcodedSites[i]["selector"]=overrideSelector;found=true}if(window.location.href.match(RegExp(hardcodedSites[i]["siteRegex"],"i"))){hardcodedSites.splice(i,1)}else{i++}}if(found==false){hardcodedSites.push({siteRegex:siteRegexp,selector:overrideSelector})}if((options.environment=="extension")&&(options.extension!="IE")){Ultralink.sendExtensionMessage("updateHardcodedSites",hardcodedSites)}sections=[];sectionHashes=[];doScan(overrideSelector)}}function makeNetworkRequest(thisSection){var dbPostfix=options.database;if((dbPostfix!=undefined)&&(dbPostfix!="undefined")&&dbPostfix){dbPostfix="/"+dbPostfix}else{dbPostfix=""}var fragmentInterface="fragment";if(options.editorStyle=="true"){fragmentInterface="fragmentBypass"}var theSectionHTML=thisSection.innerHTML;if(theSectionHTML!=""){var fragmentHash=CryptoJS.SHA1(theSectionHTML+options.replaceHyperlinks+options.environment,{asString:true});if(fragmentHash!="da39a3ee5e6b4b0d3255bfef95601890afd80709"){var urlHash=CryptoJS.SHA1(window.location.href,{asString:true});if(isIE){var callURL=APIInterface+"extension/"+fragmentInterface+"/"+urlHash+"/"+fragmentHash+dbPostfix+"?callback=Ultralink.fragmentCallback";jsonpLoad(callURL,function(data){if(data.type=="hit"){if((data.override=="")||(data.override==thisSection.selector)){sectionHashes.push(fragmentHash);if(elementInView(thisSection)){injectUltralinks(thisSection,data)}else{thisSection.fragmentData=data}}else{restartWithOverride(data.siteRegexp,data.override)}}else{if(data.type=="miss"){var sendString2="fragment="+encodeURIComponent(theSectionHTML);sendString2+="&URL="+encodeURIComponent(window.location.href);sendString2+="&associatedWebsite="+encodeURIComponent(options.associatedWebsite);sendString2+="&replaceHyperlinks="+encodeURIComponent(options.replaceHyperlinks);sendString2+="&environment="+encodeURIComponent(options.environment);jQ.ajax({type:"POST",url:APIInterface+"extension/fragmentFilter/"+urlHash+"/"+fragmentHash+dbPostfix,data:sendString2,dataType:"jsonp",success:function(data){sectionHashes.push(fragmentHash);if(elementInView(thisSection)){injectUltralinks(thisSection,data)}else{thisSection.fragmentData=data}}})}}})}else{var callURL=APIInterface+"extension/"+fragmentInterface+"/"+urlHash+"/"+fragmentHash+dbPostfix;jQ.ajax({type:"GET",url:callURL,dataType:"json",success:function(data,textStatus,jqXHR){if(data.type=="hit"){if((data.override=="")||(data.override==thisSection.selector)){if((options.environment=="extension")&&(options.extension!="IE")&&(parseInt(ulVersion)<parseInt(data.ultralinkMinVersion))){Ultralink.sendExtensionMessage("extensionOutOfDate",{currentVersion:data.ultralinkMinVersion,currentVersionString:data.ultralinkVersionString})}else{sectionHashes.push(fragmentHash);if(elementInView(thisSection)){injectUltralinks(thisSection,data)}else{thisSection.fragmentData=data}}}else{restartWithOverride(data.siteRegexp,data.override)}}else{if(data.type=="miss"){var sendStructure={fragment:encodeURIComponent(theSectionHTML),URL:encodeURIComponent(window.location.href),associatedWebsite:encodeURIComponent(options.associatedWebsite),replaceHyperlinks:encodeURIComponent(options.replaceHyperlinks),environment:encodeURIComponent(options.environment)};jQ.ajax({type:"POST",url:APIInterface+"extension/fragmentFilter/"+urlHash+"/"+fragmentHash+dbPostfix,data:sendStructure,complete:function(jqXHR,textStatus){if(jqXHR.status==200){var data=realJSON.parse(jqXHR.responseText);if((data.override=="")||(data.override==thisSection.selector)){if((options.environment=="extension")&&(options.extension!="IE")&&(parseInt(ulVersion)<parseInt(data.ultralinkMinVersion))){Ultralink.sendExtensionMessage("extensionOutOfDate",{currentVersion:data.ultralinkMinVersion,currentVersionString:data.ultralinkVersionString})}else{sectionHashes.push(fragmentHash);if(elementInView(thisSection)){injectUltralinks(thisSection,data)}else{thisSection.fragmentData=data}}}else{restartWithOverride(data.siteRegexp,data.override)}}else{if(jqXHR.status!=400){scanSection(thisSection)}}}})}}}})}}}}function scanSection(thisSection){if(!jQ.inArray(thisSection,sections)!=-1){sections.push(thisSection)}if(elementInView(thisSection)){makeNetworkRequest(thisSection)}else{thisSection.notScanned="true"}}Ultralink.uwordScanPage=function(context){jQ("uword",context).each(function(){var thisUword=jQ(this);if(this["alreadyScanned"]!="true"){this["alreadyScanned"]="true";var ul=getDataUl(this,"data-ul");if(ul){if((ul.callout)&&(ul.callout=="normal")){addTextShadowCallout(this,1)}if((ul.status)&&(ul.status!="hit")&&(options.editorStyle=="true")){this.setAttribute("title",ul.status)}}if((isIE)&&(getInternetExplorerVersion()<10)){var s=document.createElement("span");s.style.setProperty("position","absolute");s.style.setProperty("display","none");s.textContent=this.textContent;this.ieSpan=s;this.parentNode.insertBefore(s,this)}thisUword.click(function(){if((options.failsafe=="true")&&(hoverRecover==false)){pendingPopup=this;var ul=getDataUl(this,"data-ul");recordPopupClick(ul.category,ul.database,ul.ID,this.textContent);createPopup(this)}});if(options.noHover!="true"){if(!touchInterface){thisUword.hover(function(){if(options.failsafe=="true"){if(!mouseDown){if(hoverRecover==false){if(ulInlineOutOnce!=true){addTextShadowCallout(this,1);if(currentUword!=this){removeOldPopup()}pendingPopup=this;var nuThing=this;currentTimeout=setTimeout(function(){recordPopupClick(ul.category,ul.database,ul.ID,this.textContent);createPopup(nuThing)},options.hoverTime,nuThing)}}}}},function(){clearTimeout(currentTimeout);currentTimeout=undefined;if(!(ul&&(ul.callout)&&(ul.callout=="normal"))){removeTextShadowCallout(this)}pendingPopup=undefined})}}}})};function eventBoundsCheck(event){if(currentUword!=undefined){var uword=currentUword;if(uword.paper!=undefined){var P=uword.paper;var tOL=parseFloat(P.myRrect.node.parentNode.style.left);var tOT=parseFloat(P.myRrect.node.parentNode.style.top);if((event.pageX<=tOL)||(event.pageX>tOL+P.width)||(event.pageY<=tOT+(uword.thumbnailH-uword.actualThumbnailH))||(event.pageY>tOT+P.height)){var iP=uword.inlinePaper;if(iP!=undefined){tOL=parseFloat(iP.back.node.parentNode.style.left);tOT=parseFloat(iP.back.node.parentNode.style.top);if((event.pageX<=tOL)||(event.pageX>tOL+iP.width)||(event.pageY<=tOT)||(event.pageY>tOT+iP.height)){restorePreviousInlineButton(uword);removeOldInlinePopup()}}else{if(options.hoverRecoverTime>0){hoverRecover=true;setTimeout(function(){hoverRecover=false},options.hoverRecoverTime)}else{hoverRecover=false}removeOldPopup()}}}}}var twitterAPIResult={};var facebookAPIResult={};var angellistAPIResult={};Ultralink.handleExtensionMessage=function(type,result){switch(type){case"overrideSettings":overrideSettings(result);break;case"createultralink":Ultralink.createUltralinkFromSelection(result.messageSelected);break;case"Authenticated Types":supportedInlineTypes=["wikipedia","mediawiki","angellist","annotation","twitter","videoyoutube","mapgoogle","ultralinkme"];for(i=0;i<result.length;i++){supportedInlineTypes.push(result[i])}break;case"Cache Clear":delete inlineContentCache[result.service+result.URL];break;case"twitterResult":case"linkedinResult":case"facebookResult":case"googleplusResult":case"wikipediaResult":case"mediawikiResult":case"angellistResult":case"annotationResult":if(currentUword!=undefined){var uword=currentUword;if((uword.inlinePaper!=undefined)&&(uword.inlinePaper.linkType==result.type)&&(uword.inlinePaper.URL==result.URL)){if(result.status=="success"){switch(type){case"twitterResult":switch(result.command){case"profile":var profile=result.data;if(result.data.text!=undefined){profile=realJSON.parse(result.data.text)}twitterAPIResult={};twitterAPIResult.screen_name=profile.screen_name;twitterAPIResult.name=profile.name;twitterAPIResult.location=profile.location;twitterAPIResult.description=profile.description;twitterAPIResult.profile_image_url=profile.profile_image_url;twitterAPIResult.profile_image_url_https=profile.profile_image_url_https;twitterAPIResult.following=profile.following;twitterAPIResult["protected"]=profile["protected"];twitterAPIResult.profileURL=result.URL;if((profile["protected"]==true)&&(!profile.status)){expandInlinePane(twitterAPIResult,result.type,result.URL,uword.currentInlineImage)}else{setTimeout(function(){Ultralink.sendExtensionMessage("twitterQuery",{command:"timeline",URL:result.URL,profile:profile.screen_name})},10)}break;case"timeline":var timeline=result.data;if(result.data.text!=undefined){timeline=realJSON.parse(result.data.text)}twitterAPIResult.timeline=timeline;inlineContentCache[result.type+result.URL]=twitterAPIResult;expandInlinePane(twitterAPIResult,result.type,result.URL,uword.currentInlineImage);twitterAPIResult={};break}break;case"linkedinResult":if(result.command=="invite"){jQ("#inlineIframe_linkedin").contents().find("html body #linkedinConnect").hide();jQ("#inlineIframe_linkedin").contents().find("html body #LIconnectButton").hide();jQ("#inlineIframe_linkedin").contents().find("html body #LIcancelButton").hide()}else{var theContent=result;theContent.profileURL=result.URL;inlineContentCache[result.type+result.URL]=theContent;expandInlinePane(theContent,result.type,result.URL,uword.currentInlineImage)}break;case"facebookResult":switch(result.command){case"profile":facebookAPIResult={};facebookAPIResult.name=result.data.name;if(result.data.category){facebookAPIResult.category=result.data.category}if(result.data.about){facebookAPIResult.about=result.data.about}if(result.data.description){facebookAPIResult.description=result.data.description}setTimeout(function(){Ultralink.sendExtensionMessage("facebookQuery",{command:"pagePicture",URL:result.URL})},10);break;case"pagePicture":facebookAPIResult.pictureURL=result.data.data.url;setTimeout(function(){Ultralink.sendExtensionMessage("facebookQuery",{command:"pagePosts",URL:result.URL})},10);break;case"pagePosts":var theContent=result;theContent.data.pictureURL=facebookAPIResult.pictureURL;theContent.data.name=facebookAPIResult.name;if(facebookAPIResult.category){theContent.data.category=facebookAPIResult.category}if(facebookAPIResult.about){theContent.data.about=facebookAPIResult.about}if(facebookAPIResult.description){theContent.data.description=facebookAPIResult.description}inlineContentCache[result.type+result.URL]=theContent;expandInlinePane(theContent,result.type,result.URL,uword.currentInlineImage);break}break;case"googleplusResult":switch(result.command){case"profile":var theContent=result.data;theContent.pageURL=result.URL;inlineContentCache[result.type+result.URL]=theContent;expandInlinePane(theContent,result.type,result.URL,uword.currentInlineImage);break}break;case"wikipediaResult":case"mediawikiResult":switch(result.command){case"page":var theContent=result.data;theContent.pageURL=result.URL;inlineContentCache[result.type+result.URL]=theContent;expandInlinePane(theContent,result.type,result.URL,uword.currentInlineImage);break}break;case"angellistResult":switch(result.command){case"profile":angellistAPIResult=result.data;angellistAPIResult.pageURL=result.URL;if(result.data.type=="users"){Ultralink.sendExtensionMessage("angellistQuery",{command:"userRoles",URL:result.URL,id:angellistAPIResult.data.id})}else{inlineContentCache[result.type+result.URL]=angellistAPIResult;expandInlinePane(angellistAPIResult,result.type,result.URL,uword.currentInlineImage)}break;case"userRoles":angellistAPIResult.startupRoles=result.data;inlineContentCache[result.type+result.URL]=angellistAPIResult;expandInlinePane(angellistAPIResult,result.type,result.URL,uword.currentInlineImage);break}break;case"annotationResult":var theContent=result.data;inlineContentCache[result.type+result.URL]=theContent;expandInlinePane(theContent,result.type,result.URL,uword.currentInlineImage);break}}else{removeOldInlinePopup()}}}break;default:return false;break}return true};function createInlineUltralink(CS,CDSnode){var regexTheP=new RegExp("[\\.|\\+|\\*|\\?|\\[|\\^|\\]|\\$|\\(|\\)|\\{|\\}|\\=|\\!|\\<|\\>|\\||\\:|\\-]");var regexTheC=/[\u4e00-\u9faf\u3040-\u309f\u30a0-\u30ff]+/;var ng="";if(CS.match(regexTheP)||CS.match(regexTheC)){ng="?"}injectUltralinks(CDSnode,{words:[{ID:-1,caseSensitive:0,notgreedy:ng,word:CS,quotedWord:CS,ul:{ID:-1,URLS:{},category:"(NEEDS CATEGORIZATION)",status:"hit"}}]});jQ("uword:contains2("+CS+")",CDSnode).each(function(){var uword=jQ(this);if(this.textContent==CS){uword.click();ulInlineOut=true;ulInlineOutOnce=true}})}Ultralink.createUltralinkFromSelection=function(messageSelected){var selection=window.getSelection();if(selection.anchorNode==selection.focusNode){if(selection.anchorNode.parentElement.nodeName!="A"){if(selection.toString().length<64){createInlineUltralink(messageSelected,selection.anchorNode.parentNode)}}}};function consumeDOMQueue(q){setTimeout(function(){jQ("command",q).each(function(){if(Ultralink.handleExtensionMessage(this.attributes.type.value,realJSON.parse(this.textContent))){jQ(this).remove()}})},10)}function takeCareOfSection(s){var gotSomething=false;var ns=s.notScanned;if(ns){delete s.notScanned;makeNetworkRequest(s);gotSomething=true}var fd=s.fragmentData;if(fd){delete s.fragmentData;injectUltralinks(s,fd);gotSomething=true}return gotSomething}function incrementalWork(){var gotSomething=false;for(var s=0;s<sections.length;s++){gotSomething=takeCareOfSection(sections[s]);if(gotSomething){break}}var incrementTime=200;if(isFirefox){incrementTime=500}if(gotSomething){setTimeout(incrementalWork,incrementTime)}}var zeroRetry=1000;function doScan(theSelector){var qr=[];if(theSelector!=""){qr=jQ(theSelector+":not(a *)")}if((theSelector=="")||(qr.length==0)){if((theSelector==".ultralink")||(theSelector=="")){doScan(getPageContentSelectors())}else{if((theSelector!="")&&(zeroRetry<10000)){setTimeout(function(){doScan(theSelector)},zeroRetry);if(zeroRetry<10000){zeroRetry+=1000}}}}else{currentSelector=theSelector;qr.each(function(){var gotThisOne=false;for(var s=0;s<sections.length;s++){if(sections[s]==this){gotThisOne=true;break}}if(!gotThisOne){if(this.fragmentHash==undefined){this.fragmentHash=CryptoJS.SHA1(this.innerHTML+options.replaceHyperlinks+options.environment,{asString:true})}for(var s=0;s<sectionHashes.length;s++){if(sectionHashes[s]==this.fragmentHash){gotThisOne=true;break}}}if(!gotThisOne){if(this.innerHTML.length<524288){this["selector"]=theSelector;scanSection(this)}}});incrementalWork()}}function doFirstScan(){if(typeof options.scanSelector=="string"){doScan(options.scanSelector)}else{for(var t=0;t<options.scanSelector.length;t++){doScan(options.scanSelector[t])}}var scanCheckInterval=setInterval(function(){if(currentSelector!=""){doScan(currentSelector)}},5000)}function scanFirst(){var scannedFirst=false;jQ(document).ready(function(){if(!scannedFirst){scannedFirst=true;doFirstScan()}});setTimeout(function(){if(!scannedFirst){scannedFirst=true;doFirstScan()}},5000)}function noOffset(s){var day=s.slice(0,-5).split(/\D/).map(function(itm){return parseInt(itm,10)||0});day[1]-=1;day=new Date(Date.UTC.apply(Date,day));var offsetString=s.slice(-5);var offset=parseInt(offsetString,10)/100;if(offsetString.slice(0,1)=="+"){offset*=-1}day.setHours(day.getHours()+offset);return day.getTime()}function parseFacebookDate(text){var ts=noOffset(text);var date=new Date(ts).toLocaleDateString();var time=new Date(ts).toLocaleTimeString();return date+" "+time}function parseTwitterDate(text){var newtext=text.replace(/(\d{1,2}[:]\d{2}[:]\d{2}) (.*)/,"$2 $1");newtext=newtext.replace(/(\+\S+) (.*)/,"$2 $1");var date=new Date(Date.parse(newtext)).toLocaleDateString();var time=new Date(Date.parse(newtext)).toLocaleTimeString();return date+" "+time}function getFullWidth(type){switch(type){case"ultralinkme":return 600;break;default:return 500}}function getFullHeight(type){switch(type){case"mapgoogle":return 500;break;case"videoyoutube":return 375;break;case"ultralinkme":return 375;break;case"linkedin":return 250;break;case"wikipedia":return 300;break;case"mediawiki":return 300;break;default:return 350}}function finalizeExpand(contentHeight,uword,type,theImage){var P=uword.paper;var iP=uword.inlinePaper;var theIframe=jQ("iframe#inlineIframe_"+type);var fullWidth=getFullWidth(type);var fullHeight=getFullHeight(type);var iex=0;var inlineExtendedWidth=fullWidth+iex;var newHeight=(contentHeight+(inlineFullInset*2+16));if(newHeight<82){newHeight=82}var resizeDelta=0;if((newHeight>=fullHeight)||(contentHeight==0)){newHeight=fullHeight}else{resizeDelta=2+16}var minHeight=newHeight+(inlineStrokeWidth*2);var theInlinePopupCorners=inlinePopupCorners;if(type=="ultralinkme"){theInlinePopupCorners=20;iP.outline.attr("stroke-width",inlineUMStrokeWidth)}var buttonBBox=uword.paper.myRrect.getBBox();function setupMiddle(){var leftSide=uword.popupX+(buttonBBox.width/2)-(fullWidth/2);if(leftSide<5){leftSide=5}if(leftSide+inlineExtendedWidth+(inlineStrokeWidth*2)>document.body.offsetWidth-5){leftSide=document.body.offsetWidth-5-(inlineExtendedWidth+(inlineStrokeWidth*2))}var arrowOffsetX=parseFloat(iP.back.node.parentNode.style.left)-(leftSide+(fullWidth/2)-inlinePreviewX/2);iP.setSize(inlineExtendedWidth+(inlineStrokeWidth*2),minHeight+inlineArrowX);iP.back.node.parentNode.style.setProperty("left",leftSide+"px");iP.back.attr("path",rrectPathArrowUp(inlineStrokeWidth,inlineStrokeWidth+inlineArrowX,inlineExtendedWidth,newHeight,theInlinePopupCorners,inlineArrowY,inlineArrowX,arrowOffsetX));iP.outline.attr("path",rrectPathArrowUp(inlineStrokeWidth,inlineStrokeWidth+inlineArrowX,inlineExtendedWidth,newHeight,theInlinePopupCorners,inlineArrowY,inlineArrowX,arrowOffsetX));iP.inlineDiv.style.setProperty("left",leftSide+inlineFullInset+"px");iP.inlineDiv.style.setProperty("top",parseFloat(iP.back.node.parentNode.style.top)+inlineFullInset+inlineArrowX+"px")}if(uword.popupX+(buttonBBox.width/2)>document.body.offsetWidth/2){if(uword.popupX-fullWidth<0){setupMiddle()}else{iP.setSize(inlineExtendedWidth+inlineArrowX+(inlineStrokeWidth*2),minHeight);var arrowOffsetY=0;var modifiedTop=(parseFloat(iP.back.node.parentNode.style.top)-((newHeight-inlinePreviewY)/2));if(modifiedTop<5){arrowOffsetY=modifiedTop-5;modifiedTop=5}iP.back.node.parentNode.style.setProperty("top",modifiedTop+"px");iP.back.node.parentNode.style.setProperty("left",(parseFloat(iP.back.node.parentNode.style.left)-(inlineExtendedWidth-inlinePreviewX))+"px");iP.back.attr("path",rrectPathArrowRight(inlineStrokeWidth,inlineStrokeWidth,inlineExtendedWidth,newHeight,theInlinePopupCorners,inlineArrowX,inlineArrowY,arrowOffsetY));iP.outline.attr("path",rrectPathArrowRight(inlineStrokeWidth,inlineStrokeWidth,inlineExtendedWidth,newHeight,theInlinePopupCorners,inlineArrowX,inlineArrowY,arrowOffsetY));iP.inlineDiv.style.setProperty("left",(parseFloat(iP.back.node.parentNode.style.left)+inlineFullInset)+"px");iP.inlineDiv.style.setProperty("top",(parseFloat(iP.back.node.parentNode.style.top)+inlineFullInset)+"px")}}else{if(uword.popupX+buttonBBox.width+fullWidth>document.body.offsetWidth){setupMiddle()}else{iP.setSize(inlineExtendedWidth+inlineArrowX+(inlineStrokeWidth*2),minHeight);var arrowOffsetY=0;var modifiedTop=(parseFloat(iP.back.node.parentNode.style.top)-((newHeight-inlinePreviewY)/2));if(modifiedTop<5){arrowOffsetY=modifiedTop-5;modifiedTop=5}iP.back.node.parentNode.style.setProperty("top",modifiedTop+"px");iP.back.attr("path",rrectPathArrowLeft(inlineStrokeWidth+inlineArrowX,inlineStrokeWidth,inlineExtendedWidth,newHeight,theInlinePopupCorners,inlineArrowX,inlineArrowY,arrowOffsetY));iP.outline.attr("path",rrectPathArrowLeft(inlineStrokeWidth+inlineArrowX,inlineStrokeWidth,inlineExtendedWidth,newHeight,theInlinePopupCorners,inlineArrowX,inlineArrowY,arrowOffsetY));iP.inlineDiv.style.setProperty("left",(parseFloat(iP.back.node.parentNode.style.left)+inlineFullInset+inlineArrowX+iex)+"px");iP.inlineDiv.style.setProperty("top",(parseFloat(iP.back.node.parentNode.style.top)+inlineFullInset)+"px")}}iP.spinner.remove();var backShadow=iP.back.glow({color:inlineGlowColor,width:inlineGlowWidth,opacity:inlineGlowOpacity,offsety:inlineGlowOffsetY});for(var bs=0;bs<backShadow.length;bs++){backShadow[bs].node.style.stroke=backShadow[bs].node.getAttribute("stroke")}var nuHeight=minHeight-(inlineFullInset*2)+resizeDelta;jQuery(theIframe)[0].style.setProperty("height",nuHeight+2+"px");iP.inlineDiv.style.setProperty("height",nuHeight+"px");iP.inlineDiv.style.zIndex="2147483647"}function kickoffFinalize(ifDoc,uword,type,theImage){var iP=uword.inlinePaper;setTimeout(function(){var paneHeight=jQuery("#containDiv",ifDoc).height();var divHeight=(parseFloat(iP.inlineDiv.style.height)-16);if(touchInterface&&(paneHeight>divHeight)){var cd=jQuery("#containDiv",ifDoc)[0];cd.style.setProperty("height",divHeight+"px");cd.style.setProperty("overflow","auto");paneHeight=divHeight}finalizeExpand(paneHeight,uword,type,theImage)},1)}var linkRegex=RegExp("((https?|ftp)://[^\\s/$.?#].[^\\s]*)(?![^<]*(</a>|>))","gm");function expandInlinePane(content,type,URL,theImage){setTimeout(function(){Ultralink.currentInlineContent=content;var uword=currentUword;uword.expanded=true;var fullWidth=getFullWidth(type);var fullHeight=getFullHeight(type);ulInlineOut=true;ulInlineOutOnce=true;var iP=uword.inlinePaper;iP.inlineDiv=document.createElement("div");iP.inlineDiv.id="inlineContent";iP.inlineDiv.style.setProperty("position","absolute");iP.inlineDiv.style.setProperty("top","-1000px");iP.inlineDiv.style.setProperty("left","-1000px");iP.inlineDiv.style.setProperty("width",(fullWidth+(inlineStrokeWidth*2)-(inlineFullInset*2))+"px");iP.inlineDiv.style.setProperty("height",(fullHeight+(inlineStrokeWidth*2)-(inlineFullInset*2))+"px");iP.inlineDiv.style.zIndex="-2147483647";iP.inlineDiv.style.setProperty("border","none");iP.inlineDiv.style.setProperty("padding","0px");if(isFirefox){iP.back.attr("opacity",1)}else{if(type=="ultralinkme"){iP.back.attr("opacity",0.95)}else{iP.back.attr("opacity",0.9)}}var theIframe=jQ("<iframe id='inlineIframe_"+type+"' frameBorder=0 width='"+iP.inlineDiv.style.width+"' height='"+iP.inlineDiv.style.height+"' />");jQ(iP.inlineDiv).append(theIframe);switch(type){case"wikipedia":case"mediawiki":if(isIE&&(document.domain!=location.host)){theIframe[0].src='javascript:(function (){ document.open();document.domain="'+document.domain+'";document.close(); })();'}var containDiv=document.createElement("div");containDiv.id="containDiv";var mwDiv=document.createElement("div");mwDiv.style.setProperty("word-wrap","break-word");mwDiv.style.setProperty("color","white");mwDiv.style.setProperty("font-family","Helvetica");mwDiv.innerHTML=content.parse.text["*"];jQ("table.infobox",mwDiv).remove();jQ("table.infobox_v2",mwDiv).remove();jQ("table.metadata",mwDiv).remove();jQ("table.vertical-navbox",mwDiv).remove();jQ("table.toccolours",mwDiv).remove();jQ("strong.error",mwDiv).remove();jQ("sup",mwDiv).remove();jQ("span#coordinates",mwDiv).remove();jQ("div.noprint",mwDiv).remove();jQ("div.dablink",mwDiv).remove();jQ("div.thumb",mwDiv).remove();jQ("div.floatright",mwDiv).remove();jQ("object",mwDiv).remove();jQ("img",mwDiv).remove();jQ("table",mwDiv).css("color","white");jQ("#toc",mwDiv).remove();jQ("a",mwDiv).each(function(){jQ(this).replaceWith(jQ(this).html())});jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;if(type=="mediawiki"){mwDiv.style.setProperty("margin-top","16px");var theSourceSpan=document.createElement("div");theSourceSpan.style.setProperty("color","white");theSourceSpan.style.setProperty("font-family","Helvetica");theSourceSpan.style.setProperty("font-size","0.75em");theSourceSpan.style.setProperty("text-align","center");theSourceSpan.style.setProperty("margin-top","-7px");theSourceSpan.style.setProperty("margin-bottom","-10px");theSourceSpan.innerHTML="(Source: <a target='_blank' style='color: #77f' href='"+getFullDomainWithTransport(content.pageURL)+"'>"+getFullDomain(content.pageURL)+"</a>)";containDiv.appendChild(theSourceSpan)}containDiv.appendChild(mwDiv);jQ(this).contents().find("html body").append(containDiv);kickoffFinalize(ifDoc,uword,type,theImage)});break;case"twitter":if(isIE&&(document.domain!=location.host)){theIframe[0].src='javascript:(function (){ document.open();document.domain="'+document.domain+'";document.close(); })();'}var profileImageURL=content.profile_image_url;if(pageProtocol=="https://"){profileImageURL=content.profile_image_url_https}var tweetLines="";var following="";if(content.following!=undefined){following="<iframe id='twitterFollow' frameBorder=0 width='90' height='38' style='display: none;' src='"+basePath+"oauth/twitterFollow.html?profile="+content.screen_name+"&profileURL="+content.profileURL+"&following="+content.following+"' />"}tweetLines+="<div id='containDiv' style='font-family: Open Sans'><table style='width: 100%;'><tr><td style='width: 48px; padding-right: 10px; padding-left: 0px;'><img width=48 height=48 src='"+profileImageURL+"' style='border-radius: 7px;' /></td><td style='color: white;'><span style='font-size: 1.5em; font-weight: bold;'>"+content.name+"</span><br><span style='font-size: 0.8em; color: #bbb'>"+content.location+"</span></td><td style='text-align: right; padding-right: 10px; width: 99px;'>"+following+"</td></tr></table>";var tweets=content.timeline;if(tweets){tweetLines+="<div style='overflow: auto; font-family: Helvetica;'><center><table style='width: 100%;'>";for(var index=0;index<tweets.length;index++){var tweet=tweets[index];var tt=tweet.text;tt=tt.replace(/@(\w+)(?![^<]*(\<\/a\>|\>))/gm,'<a href="http://twitter.com/$1" rel="nofollow" target="_blank" style="color: #99a; text-decoration: none;">@$1</a>');tt=tt.replace(/\#(\w+)(?![^<]*(\<\/a\>|\>))/gm,' <a href="http://search.twitter.com/search?q=%23$1" rel="nofollow" target="_blank" style="color: #888; text-decoration: none;">#$1</a>');tt=tt.replace(linkRegex,'<a href="$1" target="_blank" style="color: #aac; text-decoration: none;">$1</a>');var gr="left, rgba(30,30,30,0.8) 0%,rgb(100,100,100) 20%,rgb(100,100,100) 80%,rgba(30,30,30,0.8) 100%";tweetLines+="<tr><td><section style='height: 1px; margin-top: 5px; margin-bottom: 5px; background: -moz-linear-gradient("+gr+"); background: -webkit-linear-gradient("+gr+"); background: linear-gradient("+gr+");'></section></td></tr>";tweetLines+="<tr><td style='color: #fff; font-size: 0.9em;'>"+tt+"</td></tr>";tweetLines+="<tr><td style='color: #bbb;'><small><small>"+parseTwitterDate(tweet.created_at)+"</small></small></td></tr>"}tweetLines+="</table></center></div>"}else{if(content["protected"]==true){tweetLines+="<br><div style='font-size: 1.1em; font-weight: bold; color: #bbb; text-align: center;'>Account is protected.</div>"}}tweetLines+="</div>";jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;if(content.following!=undefined){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;var jqueryScript=ifDoc.createElement("script");jqueryScript.type="text/javascript";jqueryScript.src=basePath+"ultralinkLibraries/jquery-min.js";var docScript=ifDoc.createElement("script");docScript.type="text/javascript";docScript.textContent='setTimeout( function(){ jQuery(document).ready( function(){ jQuery("#twitterFollow").fadeIn(); } ); }, 500);';ifDoc.head.appendChild(jqueryScript);ifDoc.body.appendChild(docScript)}jQ(this).contents().find("html body").append(tweetLines);kickoffFinalize(ifDoc,uword,type,theImage)});break;case"linkedin":if(isIE&&(document.domain!=location.host)){theIframe[0].src='javascript:(function (){ document.open();document.domain="'+document.domain+'";document.close(); })();'}var profileHTML="";if(content.command=="lookupPerson"){var profile=content.data;var connect="";if(profile.id=="private"){profileHTML="<div id='containDiv'><br><div style='font-size: 1.1em; font-weight: bold; color: #bbb; text-align: center;'>Account is private.</div></div>"}else{var personDistance=profile.relationToViewer.distance;var linkedinConnect="";if((personDistance==-1)||(personDistance==2)||(personDistance==3)){connect="";if(!isFirefox){connect+="<img id='LIconnectButton' src='"+basePath+'oauth/linkedinConnect1.png\' style=\'cursor: pointer;\' onclick=\'jQuery("#linkedinConnect").slideDown("slow"); jQuery(this).hide(); jQuery("#LIcancelButton").show();\' />'}connect+="<div id='LIcancelButton' style='display: none; cursor: pointer; width: 83px; text-align: center; border-radius: 10px; background: #e55; color: white; border-style: solid; border-color: #833; border-width: 2.5px; padding: 5px;' onclick='jQuery(\"#linkedinConnect\").slideUp(\"slow\"); jQuery(this).hide(); jQuery(\"#LIconnectButton\").show();'>Cancel</div>";var LIauth=profile.apiStandardProfileRequest.headers.values[0].value.split(":")[1];var ifURL=basePath+"oauth/linkedinConnect.html";linkedinConnect="<iframe id='linkedinConnect' frameBorder=0 width='100%' height='143px' style='display: none; padding-top: 5px; padding-bottom: 5px;' src='"+ifURL+"' />"}else{if(personDistance==1){connect="<div style='font-size: 0.8em; font-wight: bold; text-align: center; color: white; border-radius: 15px; background: #aad; border-style: solid; border-color: #aac; border-width: 2.5px; padding: 3px;'>Connected</div>"}}var picture="";if((profile.pictureUrl!=undefined)&&(profile.pictureUrl!="")){picture="<td style='width: 48px; padding-right: 10px; padding-left: 0px;'><img width=48 height=48 src='"+profile.pictureUrl+"' style='border-radius: 7px;' /></td>"}profileHTML="<div id='containDiv'><table style='width: 100%; font-family: Open Sans;'><tr>"+picture+"<td style='color: white;'><span style='font-size: 1.5em; font-weight: bold;'>"+profile.firstName+" "+profile.lastName+"</span><br><span style='font-size: 0.8em; color: #bbb'>"+profile.headline+"</span></td><td style='text-align: right; padding-right: 10px;'>"+connect+"</td></tr></table>";profileHTML+=linkedinConnect;if(profile.summary||profile.specialties){profileHTML+="<div style='color: white; margin-top: 5px; margin-bottom: 5px;'>";if(profile.summary){profileHTML+="<div style='font-size: 1.1em;'>"+profile.summary+"</div>"}else{if(profile.specialties){profileHTML+="<div style='font-size: 1.1em;'>"+profile.specialties+"</div>"}}profileHTML+="</div>"}if(personDistance>=2){var rc=profile.relationToViewer.relatedConnections.values;var connections="";var got=0;for(var i=0;(i<rc.length)&&(got<5);i++){if(rc[i].id!="private"){if(got==0){connections+="<center><table style='font-size: 0.6em; color: white;'><tr style='text-align: center;'><td>"}connections+=rc[i].firstName+" "+rc[i].lastName+"<br>";if((got==2)&&(rc.length!=4)){connections+="</td><td>"}got++}}var excess=profile.relationToViewer.relatedConnections._total-5;if(excess>0){connections+="(+"+excess+" more)"}connections+="</td></tr></table></center>";var third="";if(personDistance==3){third="<td style='padding-top: 4px; font-size: 1.2em;'>&#x27a1;</td><td style='font-size: 0.8em; color: #99a;'>(Their connections)</td>"}profileHTML+="<table style='color: white; width: 100%;'><tr style='text-align: center;'><td style='font-weight: bold; color: #dbb;'>You</td><td style='padding-top: 4px; font-size: 1.2em;'>&#x27a1;</td><td>"+connections+"</td>"+third+"<td style='padding-top: 4px; font-size: 1.2em;'>&#x27a1;</td><td style='font-weight: bold;'>"+profile.firstName+" "+profile.lastName+"</td></tr></table>"}profileHTML+="</div>"}jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;if(connect!=""){var jqueryScript=ifDoc.createElement("script");jqueryScript.type="text/javascript";jqueryScript.src=basePath+"ultralinkLibraries/jquery-min.js";var docScript=ifDoc.createElement("script");docScript.type="text/javascript";docScript.textContent='setTimeout( function(){ var connectButton = document.getElementById("LIconnectButton"); jQuery("#LIconnectButton").hover( function(){ connectButton.src = "'+basePath+'oauth/linkedinConnect2.png"; }, function(){ connectButton.src = "'+basePath+'oauth/linkedinConnect1.png"; } ); }, 500);';ifDoc.head.appendChild(jqueryScript);ifDoc.body.appendChild(docScript)}jQ(this).contents().find("html body").append(profileHTML);var paneHeight=0;if(connect==""){paneHeight=jQuery("#containDiv",ifDoc).height()}setTimeout(function(){finalizeExpand(paneHeight,uword,type,theImage)},1)})}else{if(content.command=="lookupCompany"){var profile=content.data;profileHTML="<div id='containDiv'><div style='color: white;'>";profileHTML+="<span style='font-size: 1.5em; font-family: Open Sans;'>"+profile.name+"</span><br>";if(profile.companyType!=undefined){profileHTML+="<span style='font-size: 1.0em; color: #bbb; font-family: Open Sans;'>"+profile.companyType.name+"</span><br><br>"}if(profile.description!=undefined){profileHTML+="<span style='font-size: 1.1em;'>"+profile.description+"</span><br>"}else{if(profile.specialties!=undefined){profileHTML+="<span style='font-size: 1.1em;'>"+profile.specialties+"</span><br>"}}profileHTML+="</div></div>";jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;jQ(this).contents().find("html body").append(profileHTML);kickoffFinalize(ifDoc,uword,type,theImage)})}else{if(content.command=="lookupGroup"){var profile=content.data;profileHTML="<div id='containDiv'><div style='color: white;'>";profileHTML+="<span style='font-size: 1.5em;'>"+profile.name+"</span><br><br>";if(profile.description!=undefined){profileHTML+="<span style='font-size: 1.1em;'>"+profile.description+"</span><br>"}profileHTML+="</div></div>";jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;jQ(this).contents().find("html body").append(profileHTML);kickoffFinalize(ifDoc,uword,type,theImage)})}}}break;case"facebook":if(isIE&&(document.domain!=location.host)){theIframe[0].src='javascript:(function (){ document.open();document.domain="'+document.domain+'";document.close(); })();'}var profile=content.data;var profileHTML="";var name=profile.name;var picture=profile.pictureURL;var headline="";var description;if(profile.category){headline=profile.category}if(profile.description){description=profile.description}else{if(profile.about){description=profile.about}}profileHTML+="<div id='containDiv'><table style='width: 100%; font-family: Open Sans;'><tr><td style='width: 48px; padding-right: 10px; padding-left: 0px;'><img width=48 height=48 src='"+picture+"' style='border-radius: 7px;' /></td><td style='color: white;'><span style='font-size: 1.5em; font-weight: bold;'>"+name+"</span><br><span style='font-size: 0.8em; color: #bbb'>"+headline+"</span></td></tr></table>";if(description){profileHTML+="<div style='color: white; margin-top: 10px;'>";if(description!=undefined){profileHTML+="<span style='font-size: 1.1em;'>"+description+"</span><br>"}profileHTML+="</div>"}var posts=profile.data;var postLines="<div><div style='overflow: auto; font-family: Helvetica;'><center><table style='width: 98%; table-layout: fixed;'>";if(posts){for(var index=0;index<posts.length;index++){var post=posts[index];var pt="";if(post.story!=undefined){pt=post.story}else{if(post.message!=undefined){pt=post.message}}pt=pt.replace(linkRegex,'<a href="$1" target="_blank" style="color: #aac; text-decoration: none;">$1</a>');var gr="left, rgba(30,30,30,0.8) 0%,rgb(100,100,100) 20%,rgb(100,100,100) 80%,rgba(30,30,30,0.8) 100%";postLines+="<tr><td><section style='height: 1px; margin-top: 5px; margin-bottom: 5px; background: -moz-linear-gradient("+gr+"); background: -webkit-linear-gradient("+gr+"); background: linear-gradient("+gr+");'></section></td></tr>";if(post.picture!=undefined){postLines+="<tr><td style='color: #fff; font-size: 0.9em; word-wrap: break-word;'><img src='"+post.picture+"' style='width: 96px; margin-right: 12px; margin-top: 2px; margin-bottom: 4px; float: left; border-radius: 7px;' />"+pt+"</td></tr>"}else{postLines+="<tr><td style='color: #fff; font-size: 0.9em; word-wrap: break-word;'>"+pt+"</td></tr>"}postLines+="<tr><td style='color: #bbb;'><small><small>"+parseFacebookDate(post.created_time)+"</small></small></td></tr>";postLines+="<tr><td><small><small> </small></small></td></tr>"}}postLines+="</table></center></div></div>";profileHTML+=postLines+"</div>";jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;jQ(this).contents().find("html body").append(profileHTML);kickoffFinalize(ifDoc,uword,type,theImage)});break;case"googleplus":if(isIE&&(document.domain!=location.host)){theIframe[0].src='javascript:(function (){ document.open();document.domain="'+document.domain+'";document.close(); })();'}var profile=content;var profileHTML="";var name=profile.displayName;var picture=profile.image.url;var headline="";var description="";if(profile.tagline){headline=profile.tagline}if(profile.aboutMe){description=profile.aboutMe}profileHTML+="<div id='containDiv'><table style='width: 100%; font-family: Open Sans;'><tr><td style='width: 48px; padding-right: 10px; padding-left: 0px;'><img width=48 height=48 src='"+picture+"' style='border-radius: 7px;' /></td><td style='color: white;'><span style='font-size: 1.5em; font-weight: bold;'>"+name+"</span><br><span style='font-size: 0.8em; color: #bbb'>"+headline+"</span></td></tr></table>";if(description){profileHTML+="<div style='color: white; margin-top: 10px;'>";if(description!=undefined){profileHTML+="<span style='font-size: 1.1em;'>"+description+"</span><br>"}profileHTML+="</div>"}jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;jQ(this).contents().find("html body").append(profileHTML);kickoffFinalize(ifDoc,uword,type,theImage)});break;case"angellist":if(isIE&&(document.domain!=location.host)){theIframe[0].src='javascript:(function (){ document.open();document.domain="'+document.domain+'";document.close(); })();'}var profile=content.data;var profileHTML="";var name=profile.name;var picture;var headline="";var description="";if(content.type=="users"){picture=profile.image;if(profile.bio!=null){headline=profile.bio}}else{if(content.type=="startups"){picture=profile.logo_url;if(profile.high_concept!=null){headline=profile.high_concept}if(profile.product_desc!=null){description=profile.product_desc}}}profileHTML+="<div id='containDiv'><table style='width: 100%; font-family: Open Sans;'><tr><td style='width: 48px; padding-right: 10px; padding-left: 0px; text-align: center; height: 50px;'><img src='"+picture+"' style='border-radius: 7px; max-height: 48px; max-height: 48px;' /></td><td style='color: white;'><span style='font-size: 1.5em; font-weight: bold;'>"+name+"</span><br><span style='font-size: 0.8em; color: #bbb'>"+headline+"</span></td></tr></table>";if(description){profileHTML+="<div style='color: white; margin-top: 10px;'>";if(description!=undefined){profileHTML+="<span style='font-size: 1.1em;'>"+description+"</span><br>"}profileHTML+="</div>"}if(content.type=="users"){if(content.startupRoles.startup_roles.length>0){var roles=content.startupRoles.startup_roles;function roleNumber(r){switch(r){case"founder":return 0;case"investor":return 1;case"employee":return 2;case"board_member":return 3;case"advisor":return 4;case"past_investor":return 5}}function roleName(r){switch(r){case"founder":return"Founder";case"investor":return"Investor";case"employee":return"Employee";case"board_member":return"Board Member";case"advisor":return"Advisor";case"past_investor":return"Past Investor"}}function roleCompare(a,b){if(a.role==b.role){if(a.startup.quality>b.startup.quality){return -1}else{if(a.startup.quality<b.startup.quality){return 1}}return 0}if(roleNumber(a.role)>roleNumber(b.role)){return 1}else{return -1}}roles.sort(roleCompare);profileHTML+="<div><div style='overflow: auto; font-family: Helvetica; margin-top: 5px;'><center><table style='width: 90%; table-layout: fixed;'>";for(var i=0;i<roles.length;i++){var role=roles[i];var startup=role.startup;profileHTML+="<tr style='color: white; height: 34px;'><td style='width: 34px; text-align: center;'><img src='"+startup.logo_url+"' style='width: 32px; max-height: 32px; border-radius: 5px;' /></td><td style='padding-left: 5px;'><a href='"+startup.angellist_url+"' target='_blank' style='color: #aac; text-decoration: none;'>"+startup.name+"</a></td><td style='width: 110px; text-align: center;'>"+roleName(role.role)+"</td></tr>";profileHTML+="<tr><td></td><td></td><td><small><small> </small></small></td></tr>"}profileHTML+="</table></center></div></div>"}}profileHTML+="</div>";jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;jQ(this).contents().find("html body").append(profileHTML);kickoffFinalize(ifDoc,uword,type,theImage)});break;case"annotation":if(isIE&&(document.domain!=location.host)){theIframe[0].src='javascript:(function (){ document.open();document.domain="'+document.domain+'";document.close(); })();'}var containDiv=document.createElement("div");containDiv.id="containDiv";containDiv.style.setProperty("color","white");containDiv.style.setProperty("font-family","Open Sans");containDiv.innerHTML=content.text;jQ(theIframe).load(function(){var theIF=document.getElementById("inlineIframe_"+type);var ifDoc=theIF.contentDocument||theIF.contentWindow.document;jQ(this).contents().find("html body").append(containDiv);kickoffFinalize(ifDoc,uword,type,theImage)});break;case"videoyoutube":jQ(theIframe).load(function(){var tif=document.getElementById("inlineIframe_"+type);if((tif.src==undefined)||(tif.src=="")){tif.src=content;setTimeout(function(){finalizeExpand(0,uword,type,theImage)},1)}});break;case"mapgoogle":jQ(theIframe).load(function(){var tif=document.getElementById("inlineIframe_"+type);if((tif.src==undefined)||(tif.src=="")){tif.src=content;setTimeout(function(){finalizeExpand(0,uword,type,theImage)},1)}});break;case"ultralinkme":jQ(theIframe).load(function(){var tif=document.getElementById("inlineIframe_"+type);if((tif.src==undefined)||(tif.src=="")){tif.src=content;setTimeout(function(){finalizeExpand(0,uword,type,theImage)},1)}});break}document.body.appendChild(iP.inlineDiv)},1)}function createInlinePopup(type,URL,el){if(jQ.inArray(type,supportedInlineTypes)!=-1){if((currentUword!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")){var uword=currentUword;removeOldInlinePopup();uword.currentInlineImage=el;var elX=parseFloat(el.style.left);var elY=parseFloat(el.style.top);var elW=parseFloat(el.image.style.width);var elH=parseFloat(el.image.style.height);var buttonBBox=uword.paper.myRrect.getBBox();var iP;var fullWidth=getFullWidth(type);function setupMiddle(){iP=new Raphael(elX+elW/2-inlinePreviewX/2-inlineStrokeWidth,elY+elH,inlinePreviewX+(inlineStrokeWidth*2),inlinePreviewY+inlineArrowX+(inlineStrokeWidth*2));iP.back=iP.path(rrectPathArrowUp(inlineStrokeWidth,inlineStrokeWidth+inlineArrowX,inlinePreviewX,inlinePreviewY,inlinePopupCorners,inlineArrowY,inlineArrowX,0));iP.outline=iP.path(rrectPathArrowUp(inlineStrokeWidth,inlineStrokeWidth+inlineArrowX,inlinePreviewX,inlinePreviewY,inlinePopupCorners,inlineArrowY,inlineArrowX,0));iP.spinner=iP.image(options.imagesURL+"inlineLoading.gif",inlineStrokeWidth+inlinePreviewSpinnerInset,inlineStrokeWidth+inlinePreviewSpinnerInset+inlineArrowX,inlinePreviewX-(inlinePreviewSpinnerInset*2),inlinePreviewY-(inlinePreviewSpinnerInset*2))}var buttonXMiddle=elX+elW/2;var buttonXLeft=buttonXMiddle-elW/2;var buttonXRight=buttonXMiddle+elW/2;if(uword.popupX+(buttonBBox.width/2)>document.body.offsetWidth/2){if(uword.popupX-fullWidth<0){setupMiddle()}else{iP=new Raphael(uword.popupX+rectPopupOffsetX+rectPaddingX-inlinePreviewX-inlineArrowX+inlineOffsetX-inlineStrokeWidth-2,elY+elH/2-inlinePreviewY/2-inlineStrokeWidth,inlinePreviewX+inlineArrowX+(inlineStrokeWidth*2),inlinePreviewY+(inlineStrokeWidth*2));iP.back=iP.path(rrectPathArrowRight(inlineStrokeWidth,inlineStrokeWidth,inlinePreviewX,inlinePreviewY,inlinePopupCorners,inlineArrowX,inlineArrowY,0));iP.outline=iP.path(rrectPathArrowRight(inlineStrokeWidth,inlineStrokeWidth,inlinePreviewX,inlinePreviewY,inlinePopupCorners,inlineArrowX,inlineArrowY,0));iP.spinner=iP.image(options.imagesURL+"inlineLoading.gif",inlineStrokeWidth+inlinePreviewSpinnerInset,inlineStrokeWidth+inlinePreviewSpinnerInset,inlinePreviewX-(inlinePreviewSpinnerInset*2),inlinePreviewY-(inlinePreviewSpinnerInset*2))}}else{if(uword.popupX+buttonBBox.width+fullWidth>document.body.offsetWidth){setupMiddle()}else{iP=new Raphael(uword.popupX+rectPopupOffsetX+rectPaddingX+buttonBBox.width-inlineOffsetX-inlineArrowX-2,elY+elH/2-inlinePreviewY/2-inlineStrokeWidth,inlinePreviewX+inlineArrowX+(inlineStrokeWidth*2),inlinePreviewY+(inlineStrokeWidth*2));iP.back=iP.path(rrectPathArrowLeft(inlineStrokeWidth+inlineArrowX,inlineStrokeWidth,inlinePreviewX,inlinePreviewY,inlinePopupCorners,inlineArrowX,inlineArrowY,0));iP.outline=iP.path(rrectPathArrowLeft(inlineStrokeWidth+inlineArrowX,inlineStrokeWidth,inlinePreviewX,inlinePreviewY,inlinePopupCorners,inlineArrowX,inlineArrowY,0));iP.spinner=iP.image(options.imagesURL+"inlineLoading.gif",inlineStrokeWidth+inlinePreviewSpinnerInset+inlineArrowX,inlineStrokeWidth+inlinePreviewSpinnerInset,inlinePreviewX-(inlinePreviewSpinnerInset*2),inlinePreviewY-(inlinePreviewSpinnerInset*2))}}uword.inlinePaper=iP;iP.buttonXMiddle=buttonXMiddle;iP.buttonXLeft=buttonXLeft;iP.buttonXRight=buttonXRight;iP.ULAnchor=el;iP.linkType=type;iP.URL=URL;iP.back.attr("stroke-width",0);iP.back.attr("stroke-opacity",0);iP.outline.attr("stroke-width",inlineStrokeWidth);iP.outline.attr("stroke-opacity",inlineStrokeOpacity);if(type=="ultralinkme"){iP.back.attr("fill","60-#e2e2e2:"+0+"-#fafafa");if(isFirefox){iP.back.attr("opacity","1.0")}else{iP.back.attr("opacity","0.95")}iP.outline.attr("stroke","#aab");iP.outline.node.style.stroke="#aab"}else{iP.back.attr("fill",inlineBackColor);if(isFirefox){iP.back.attr("opacity","1.0")}else{iP.back.attr("opacity",generalOpacity)}iP.outline.attr("stroke",inlineStrokeColor);iP.outline.node.style.stroke=inlineStrokeColor}iP.back.node.parentNode.style.zIndex="2147483646";iP.back.node.style.fill=iP.back.node.getAttribute("fill");var theContent=inlineContentCache[type+URL];var ulAnchor=iP.ULAnchor;var href=ulAnchor.UMUrl;if(theContent){expandInlinePane(theContent,type,URL,el)}else{switch(type){case"linkedin":if(URL.match(RegExp(".*linkedin.com/(in|pub)"))){Ultralink.sendExtensionMessage("linkedinQuery",{command:"lookupPerson",URL:URL})}else{if(URL.match(RegExp(".*linkedin.com/company"))){Ultralink.sendExtensionMessage("linkedinQuery",{command:"lookupCompany",URL:URL})}else{if(URL.match(RegExp(".*linkedin.com/groups"))){Ultralink.sendExtensionMessage("linkedinQuery",{command:"lookupGroup",URL:URL})}else{removeOldInlinePopup()}}}break;case"facebook":Ultralink.sendExtensionMessage("facebookQuery",{command:"profile",URL:URL});break;case"googleplus":Ultralink.sendExtensionMessage("googleplusQuery",{command:"profile",URL:URL});break;case"videoyoutube":if(URL.match(RegExp(".*youtube.com"))){if(URL.match(RegExp(".*youtube.com/embed/"))){expandInlinePane(URL,type,URL,el)}else{if(URL.match(RegExp(".*youtube.com/watch"))){var componentMatches=/.*youtube\.com\/watch\?.*v=(.+?)($|&)/.exec(URL);expandInlinePane(pageProtocol+"www.youtube.com/embed/"+componentMatches[1],type,URL,el)}else{removeOldInlinePopup()}}}else{removeOldInlinePopup()}break;case"mapgoogle":if(URL.match(RegExp(".*maps.google.com"))){var componentMatches=/.*maps\.google\.com(.*)/.exec(URL);expandInlinePane(pageProtocol+"maps.google.com"+componentMatches[1]+"&output=embed",type,URL,el)}else{removeOldInlinePopup()}break;case"ultralinkme":var componentMatches=/.*ultralink\.me.*\/description\/((.*)\/)?(.+?)($|\?)/.exec(URL);var database=componentMatches[2];var wordID=componentMatches[3];var dvURL="https://ultralink.me/extension/descriptionView.html?ID="+encodeURIComponent(wordID)+"&pageTitle="+encodeURIComponent(document.title)+"&pageURL="+encodeURIComponent(location.href);if(uword.multipleUltralinks){var dul=getDataUl(uword,"data-ul");dvURL+="&dominantUltralink="+encodeURIComponent(dul.ID)}if(database){dvURL+="&database="+encodeURIComponent(database)}if(wordID<0){dvURL+="&word="+encodeURIComponent(uword.textContent);if(options.database!=""){dvURL+="&database="+encodeURIComponent(options.database)}}expandInlinePane(dvURL,type,URL,el);break;case"twitter":var componentMatches=/.*twitter\.com.*\/(.+?)$/.exec(URL);var account=componentMatches[1].replace("/","");if((jQ.inArray("twitter-auth",supportedInlineTypes)!=-1)||((options.environment=="extension")&&(options.extension!="IE"))){Ultralink.sendExtensionMessage("twitterQuery",{command:"profile",URL:URL,profile:account})}else{var queryURL;queryURL=pageProtocol+"api.twitter.com/1/users/show.json?screen_name="+encodeURIComponent(account);jQ.ajax({type:"GET",dataType:"jsonp",url:queryURL,success:function(data){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){theContent={};theContent.screen_name=account;theContent.name=data.name;theContent.location=data.location;theContent.description=data.description;theContent.profile_image_url=data.profile_image_url;theContent.profile_image_url_https=data.profile_image_url_https;if(data["protected"]==false){jQ.ajax({type:"GET",dataType:"jsonp",url:pageProtocol+"api.twitter.com/1/statuses/user_timeline.json?trim_user=1&screen_name="+encodeURIComponent(account),success:function(data2){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){theContent.timeline=data2;inlineContentCache[type+URL]=theContent;expandInlinePane(theContent,type,URL,el)}},error:function(){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){removeOldInlinePopup()}}})}else{inlineContentCache[type+URL]=theContent;expandInlinePane(theContent,type,URL,el)}}},error:function(){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){removeOldInlinePopup()}}})}break;case"wikipedia":if((options.environment=="extension")&&(options.extension!="IE")){Ultralink.sendExtensionMessage("wikipediaQuery",{command:"page",URL:URL})}else{var componentMatches=/(.*)\:\/\/(.*)\/wiki\/(.*)/.exec(URL);var queryURL=pageProtocol+componentMatches[2]+"/w/api.php?action=parse&format=json&redirects=&prop=text&section=0&page="+encodeURIComponent(decodeURI(componentMatches[3]));jQ.ajax({type:"GET",dataType:"jsonp",url:queryURL,success:function(data){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){theContent=data;inlineContentCache[type+URL]=theContent;expandInlinePane(theContent,type,URL,el)}},error:function(){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){removeOldInlinePopup()}}})}break;case"mediawiki":if(((options.environment=="extension")&&(options.extension!="IE"))&&(!isChrome)){Ultralink.sendExtensionMessage("mediawikiQuery",{command:"page",URL:URL})}else{var componentMatches=/(.*)\:\/\/(.*?)\/(wiki\/index\.php\/)?(wiki\/)?(.*)/.exec(URL);var queryURL=componentMatches[1]+"://"+componentMatches[2]+"/wiki/api.php?action=parse&format=json&redirects=&prop=text&section=0&page="+encodeURIComponent(decodeURI(componentMatches[5]));var dType="jsonp";jQ.ajax({type:"GET",dataType:dType,url:queryURL,success:function(data){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){theContent=data;theContent.pageURL=URL;inlineContentCache[type+URL]=theContent;expandInlinePane(theContent,type,URL,el)}},error:function(){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){removeOldInlinePopup()}}})}break;case"angellist":if(((options.environment=="extension")&&(options.extension!="IE"))&&(!isOpera)){Ultralink.sendExtensionMessage("angellistQuery",{command:"profile",URL:URL})}else{var componentMatches=/.*angel\.co\/(.+?)($|\?)/.exec(URL);var slug=componentMatches[1];var dType="jsonp";var queryURL="https://api.angel.co/1/search/slugs?query="+encodeURIComponent(slug);jQ.ajax({type:"GET",dataType:dType,url:queryURL,success:function(data){var alType="";if(data.type=="User"){alType="users"}else{if(data.type=="Startup"){alType="startups"}else{removeOldInlinePopup();return}}queryURL="https://api.angel.co/1/"+alType+"/search?slug="+encodeURIComponent(slug);jQ.ajax({type:"GET",dataType:dType,url:queryURL,success:function(data){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){if(data.id!=undefined){if(alType=="users"){angellistAPIResult={};angellistAPIResult.type=alType;angellistAPIResult.data=data;angellistAPIResult.pageURL=URL;queryURL="https://api.angel.co/1/users/"+data.id+"/startups";jQ.ajax({type:"GET",dataType:dType,url:queryURL,success:function(data){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){angellistAPIResult.startupRoles=data;inlineContentCache[type+URL]=angellistAPIResult;expandInlinePane(angellistAPIResult,type,URL,el)}},error:function(xhr){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){removeOldInlinePopup()}}})}else{if(alType=="startups"){theContent={type:alType,data:data};theContent.pageURL=URL;inlineContentCache[type+URL]=theContent;expandInlinePane(theContent,type,URL,el)}}}else{removeOldInlinePopup()}}},error:function(xhr){removeOldInlinePopup()}})},error:function(xhr){removeOldInlinePopup()}})}break;case"annotation":if(((options.environment=="extension")&&(options.extension!="IE"))&&(!isChrome)){Ultralink.sendExtensionMessage("annotationQuery",{URL:URL})}else{var componentMatches=/(.*)\:\/\/ultralink\.me\/annotation\/(.+)\/([^\?]+)/.exec(URL);var queryURL="https://ultralink.me/API/current/website/getAnnotation?database="+encodeURIComponent(decodeURI(componentMatches[2]))+"&description_ID="+encodeURIComponent(decodeURI(componentMatches[3]));var dType="jsonp";if(isChrome){dType="json"}jQ.ajax({type:"GET",dataType:dType,url:queryURL,success:function(data){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){theContent=data;theContent.pageURL=URL;inlineContentCache[type+URL]=theContent;expandInlinePane(theContent,type,URL,el)}},error:function(){if((currentUword!=undefined)&&(currentUword.inlinePaper!=undefined)&&(typeof type!="undefined")&&(typeof URL!="undefined")&&(currentUword.inlinePaper.linkType==type)&&(currentUword.inlinePaper.URL==URL)){removeOldInlinePopup()}}})}break;default:}}var rehookTimer=10;if(touchInterface){rehookTimer=1000}else{if(isOpera){rehookTimer=500}}setTimeout(function(){if(ulAnchor!=undefined){ulAnchor.href=href;ulAnchor.UMActionType="blueShadow";ulAnchor.outline.className="ultralinkLinkImageBackNoPreview"}},rehookTimer)}}}Ultralink.setOptions=function(userOptions){var attrname;for(attrname in userOptions){options[attrname]=userOptions[attrname];if(attrname=="basePath"){basePath=options.basePath}if(attrname=="hardcodedSites"){for(var i=0;i<options.hardcodedSites.length;i++){var found=false;for(var j=0;j<hardcodedSites.length;j++){if(hardcodedSites[j]["siteRegex"]==options.hardcodedSites[i]["siteRegex"]){hardcodedSites[j]["selector"]=options.hardcodedSites[i]["selector"];found=true;break}if(found==false){hardcodedSites.push(options.hardcodedSites[i])}}}}}if(options.failsafe=="false"){clearAllHighlights()}if(options.forceReload=="true"){removeOldPopup();hoverRecover=false;options.forceReload="false"}};function extendJQ(){if(!jQ.expr[":"].icontains){jQ.expr[":"].icontains=function(obj,index,meta,stack){return(obj.textContent||obj.innerText||jQ(obj).text()||"").toLowerCase().indexOf(meta[3].toLowerCase())>=0}}if(!jQ.expr[":"].contains2){jQ.expr[":"].contains2=function(obj,index,meta,stack){var children=obj.childNodes;if(children){var index=children.length;while(--index>=0){var child=children[index];if(child.nodeType==Node.TEXT_NODE){if((child.textContent||child.innerText||jQ(child).text()||"").indexOf(meta[3])>=0){return true}}}}return false}}if(!jQ.expr[":"].icontains2){jQ.expr[":"].icontains2=function(obj,index,meta,stack){var children=obj.childNodes;if(children){var index=children.length;while(--index>=0){var child=children[index];if(child.nodeType==Node.TEXT_NODE){if((child.textContent||child.innerText||jQ(child).text()||"").toLowerCase().indexOf(meta[3].toLowerCase())>=0){return true}}}}return false}}}function reallyStartUltralink(userOptions){if(alreadyStarted==false){alreadyStarted=true;extendJQ();resetConstants();Ultralink.setOptions(userOptions);jQ("ultralinkloaded").bind("DOMSubtreeModified",function(e){consumeDOMQueue(this)});consumeDOMQueue(jQ("ultralinkloaded")[0]);if(touchInterface){var touchTrack={};document.addEventListener("touchmove",function(event){var touches=event.changedTouches;if(touches.length==1){var first=touches[0];touchTrack[first.identifier]=true}},true);document.addEventListener("touchend",function(event){var touches=event.changedTouches;if(touches.length==1){var first=touches[0];if(touchTrack[first.identifier]){delete touchTrack[first.identifier]}else{if(currentUword==undefined){for(var s=0;s<sections.length;s++){if(elementInView(sections[s])){jQ("uword",sections[s]).each(function(){var ul=getDataUl(this,"data-ul");if(!(ul&&(ul.callout)&&(ul.callout=="normal"))){if(elementInView(this)){setShadowRipple(this,first)}}})}}}eventBoundsCheck(first)}}},true)}else{jQ(document).mousemove(function(event){if(ulInlineOutOnce!=true){eventBoundsCheck(event)}if(currentUword==undefined){if((options.failsafe=="true")&&(options.proximityFade=="true")){for(var s=0;s<sections.length;s++){if(elementInView(sections[s])){takeCareOfSection(sections[s]);jQ("uword",sections[s]).each(function(){setShadowCallout(this,event)})}}}}});jQ(document).click(function(event){eventBoundsCheck(event)});jQ(document).keydown(function(event){if((options.failsafe=="true")&&event.altKey){highlightVisibleUltralinks()}if(event.altKey){altDown=1}});jQ(document).keyup(function(event){if(!(event.altKey)){if(altDown){altDown=0;clearAllHighlights()}}})}jQ(window).scroll(function(){for(var s=0;s<sections.length;s++){if(elementInView(sections[s])){takeCareOfSection(sections[s])}}});jQ(document).ready(function(){bodyCheck();setTimeout(function(){bodyCheck();var checkTimes=0;var bodyCheckInterval=setInterval(function(){bodyCheck();checkTimes++;if(checkTimes>15){clearInterval(bodyCheckInterval)}},2000)},1000);document.body.onmousedown=function(e){mouseDown=1};document.body.onmouseup=function(e){mouseDown=0}});if(options.scanFirst=="true"){scanFirst()}else{Ultralink.uwordScanPage(document);if(options.sectionSelector){jQ(options.sectionSelector).each(function(){sections.push(this)})}}}else{Ultralink.setOptions(userOptions)}}Ultralink.startUltralink=function(userOptions){if(!userOptions){userOptions=""}else{if(userOptions.basePath){basePath=userOptions.basePath}}var reallyStart=false;if((typeof jQuery!="undefined")&&(typeof Raphael!="undefined")){jQuery.isVersion=isVersion;if(!jQuery.isVersion("1.7",">")){jQ=jQuery}if(jQ!=undefined){reallyStart=true}else{passedOptions=userOptions}}else{passedOptions=userOptions}if(reallyStart){reallyStartUltralink(userOptions)}else{if(typeof jQuery=="undefined"){loadScript(basePath+"ultralinkLibraries/jquery+patch-min.js",loadCallback)}else{jQuery.isVersion=isVersion;if(jQuery.isVersion("1.7",">")){oldJQuery=jQuery;loadScript(basePath+"ultralinkLibraries/jquery+patch-min.js",loadCallback)}}if(typeof Raphael=="undefined"){loadScript(basePath+"ultralinkLibraries/raphael+patch-min.js",loadCallback)}}};if(typeof jQuery!="undefined"){jQuery.isVersion=isVersion;if(!jQuery.isVersion("1.7",">")){jQ=jQuery;extendJQ()}}Ultralink.loaded=true;var head=document.getElementsByTagName("head")[0];if(head){for(var i=0;i<head.children.length;i++){if(head.children[i].tagName.toLowerCase()=="ultralinkloaded"){Ultralink.loaded=false}}}else{Ultralink.loaded=false}if(Ultralink.loaded){head.appendChild(document.createElement("ultralinkloaded"));var blueAlpha=0.25;var blackAlpha=0.4;if(isOpera){blueAlpha*=2;blackAlpha*=1.75}var uwordStyle=document.createElement("style");uwordStyle.id="ultralinkCSS";uwordStyle.type="text/css";var textShadows="rgba(0,0,0,"+labelTextShadowOpacity+") 0 1px "+labelTextShadowRadius+", rgba(0,0,0,"+blackAlpha+") -1px  0px 1px,rgba(0,0,0,"+blackAlpha+") -1px  2px 1px,rgba(0,0,0,"+blackAlpha+")  1px  2px 1px,rgba(0,0,0,"+blackAlpha+")  1px  0px 1px,rgba(0,0,255,"+blueAlpha+") -1px -1px 1px,rgba(0,0,255,"+blueAlpha+") -1px  1px 1px,rgba(0,0,255,"+blueAlpha+")  1px  1px 1px,rgba(0,0,255,"+blueAlpha+")  1px -1px 1px";var boxShadowRadius=6;if(isFirefox||isOpera){boxShadowRadius=4}var cssString="";cssString+="@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: 700; src: local('Open Sans Bold'), local('OpenSans-Bold'), url("+options.imagesURL+"/OpenSans700.ttf) format('truetype'); src: url("+options.imagesURL+"/OpenSans700.eot); src: local('Open Sans Bold'), local('OpenSans-Bold'), url("+options.imagesURL+"/OpenSans700.eot) format('embedded-opentype'), url("+options.imagesURL+"/OpenSans700.woff) format('woff'); }";cssString+="uword { white-space: nowrap; cursor: pointer; } ";cssString+="span.ultralinkLink { float: none; margin: 0; padding: 0; border: 0; outline: 0; background:transparent; vertical-align: baseline; position: absolute; color: "+buttonLabelColor+"; text-decoration: none; cursor: default; font-family: Open Sans, Arial; font-weight: bold; font-style: normal; z-index: 2147483645; text-shadow: "+textShadows+";} ";cssString+="div.ultralinkLinkImageBackPreview { float: none; margin: 0; padding: 0; border: 0; outline: 0; vertical-align: baseline; position: absolute; z-index: 2147483645; box-shadow: 0 0 "+boxShadowRadius+"px rgb(30,30,30); background: rgba(30,30,30,0.5);} ";cssString+="div.ultralinkLinkImageBackNoPreview { float: none; margin: 0; padding: 0; border: 0; outline: 0; vertical-align: baseline; position: absolute; z-index: 2147483645; box-shadow: 0 0 "+boxShadowRadius+"px rgb(0,0,192); background: rgba(0,0,192,0.5);} ";cssString+="a.ultralinkLinkImageLink, a.ultralinkLinkImageLink:hover { float: none; margin: 0; padding: 0; border: 0; outline: 0; background:transparent; vertical-align: baseline; position: absolute; z-index: 2147483645; cursor: pointer; line-height: 0px; } ";cssString+="img.ultralinkLinkImage, img.ultralinkLinkImage:hover { float: none; margin: 0; padding: 0; border: 0; outline: 0; background:transparent; cursor: pointer; }";uwordStyle.textContent=cssString;head.appendChild(uwordStyle);var iterations=0;function reAddCss(){setTimeout(function(){if(typeof jQ!="undefined"){if(jQ("#ultralinkCSS").length==0){head.appendChild(uwordStyle)}if(iterations++<30){reAddCss()}}else{reAddCss()}},1000)}reAddCss();var fontLoader=document.createElement("div");fontLoader.id="ultralinkFontLoader";fontLoader.style.setProperty("position","absolute");fontLoader.style.setProperty("top","-1000px");fontLoader.style.setProperty("left","-1000px");fontLoader.style.setProperty("font-family","Open Sans");fontLoader.textContent=".";function loadFont(){document.body.appendChild(fontLoader);setTimeout(function(){var fl=document.getElementById("ultralinkFontLoader");if(fl){document.body.removeChild(fl)}},1)}if(document.body){loadFont()}else{var ct=0;var bcInterval=setInterval(function(){if(document.body){loadFont();clearInterval(bcInterval)}ct++;if(ct>100){clearInterval(bcInterval)}},100)}}if(typeof window.Ultralink=="undefined"){window.Ultralink=Ultralink}var theDefine;if(typeof define=="function"){theDefine=define}else{if((typeof CloudFlare!="undefined")&&(CloudFlare.define)){theDefine=CloudFlare.define}}if(theDefine){theDefine(["ultralinkLibraries/jquery+patch-min.js","ultralinkLibraries/raphael+patch-min.js"],function(){return Ultralink})}return Ultralink}());